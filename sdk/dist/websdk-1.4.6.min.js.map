{"version":3,"sources":["websdk-1.4.6.js"],"names":["root","factory","exports","module","define","amd","this","modules","__webpack_require__","moduleId","installedModules","id","loaded","call","m","c","p","_parsePrivacy","iq","list","items","getElementsByTagName","i","length","item","jid","getAttribute","order","type","n","_parseNameFromJidFn","name","_parseGroupBlacklist","affiliation","nick","_setText","valueDom","v","textContent","text","_version","_code","code","_utils","utils","_msg","_message","_msgHash","Queue","window","URL","webkitURL","mozURL","msURL","XDomainRequest","prototype","oldsend","send","apply","arguments","readyState","Strophe","Request","_newXHR","xhr","xmlrequest","overrideMimeType","onreadystatechange","func","bind","Websocket","_closeSocket","socket","me","setTimeout","close","e","_onMessage","message","WebIM","config","isDebug","console","log","ts","data","elem","indexOf","DOMParser","parseFromString","documentElement","see_uri","_conn","_changeConnectStatus","Status","REDIRECT","reset","service","_connect","_doDisconnect","search","_handleStreamStart","_streamWrap","_check_streamerror","ERROR","disconnecting","firstChild","nodeName","xmlInput","rawInput","serialize","_dataRecv","_listenNetwork","onlineCallback","offlineCallback","addEventListener","attachEvent","document","body","_parseRoom","result","rooms","roomJid","tmp","split","room","roomId","push","_parseRoomOccupants","occupants","_parseResponseMessage","msginfo","parseMsgData","errorMsg","msgBodies","msgBody","childNodes","childNode","nodeType","ElementType","TEXT","jsondata","wholeText","nodeValue","replace","eval","delayTags","delayTag","delayMsgTime","delayTimeStamp","childrens","child","domain","tempstr","findex","substring","atindex","_parseFriend","queryTag","conn","from","rouster","subscription","friend","ask","groups","forEachChild","group","getText","subscribe","toJid","subscribed","_login","options","accessToken","access_token","stringify","onError","WEBIM_CONNCTION_OPEN_USERGRID_ERROR","context","accessTokenExpires","expires_in","stropheConn","isOpening","isOpened","getStrophe","callback","status","msg","_loginCallback","route","connect","wait","hold","_parseMessageType","msgtype","receiveinfo","namespaceURI","inviteinfo","_handleMessageQueue","hasOwnProperty","conflict","error","CONNFAIL","WEBIM_CONNCTION_SERVER_CLOSE_ERROR","reconnect","ATTACHED","CONNECTED","intervalId","setInterval","handelSendQueue","handleMessage","handleReceivedMessage","handleInviteMessage","handlePresence","handlePing","handleIqRoster","handleIqPrivacy","handleIq","addHandler","STATUS_OPENED","supportRecMessage","WEBIM_MESSAGE_REC_TEXT","WEBIM_MESSAGE_REC_EMOJI","isCanDownLoadFile","WEBIM_MESSAGE_REC_PHOTO","WEBIM_MESSAGE_REC_AUDIO_FILE","supportSedMessage","WEBIM_MESSAGE_SED_TEXT","isCanUploadFile","notifyVersion","retry","heartBeat","isAutoLogin","setPresence","onOpened","canReceive","canSend","DISCONNECTING","stopHeartBeat","STATUS_CLOSING","DISCONNECTED","autoReconnectNumTotal","autoReconnectNumMax","WEBIM_CONNCTION_DISCONNECTED","STATUS_CLOSED","clear","onClosed","AUTHFAIL","WEBIM_CONNCTION_AUTH_ERROR","STATUS_ERROR","WEBIM_CONNCTION_SERVER_ERROR","status_now","_getJid","appKey","to","resource","_getJidByName","_validCheck","user","WEBIM_CONNCTION_USER_NOT_ASSIGN_ERROR","devInfos","WEBIM_CONNCTION_APPKEY_NOT_ASSIGN_ERROR","orgName","appName","toLowerCase","isMultiLoginSessions","Date","getTime","Math","floor","random","toFixed","userId","_getXmppUrl","baseUrl","https","test","url","prefix","base","suffix","isSupportWss","WebSocket","connection","isHttpDNS","location","protocol","inactivity","heartBeatWait","maxRetries","pollingTime","autoReconnectInterval","STATUS_INIT","sendQueue","apiUrl","isWindowSDK","dnsArr","dnsIndex","dnsTotal","restHosts","restIndex","restTotal","xmppHosts","xmppIndex","xmppTotal","registerUser","getHttpDNS","signup","pop","sendReceiptsMessage","listen","emptyfn","onTextMessage","onEmojiMessage","onPictureMessage","onAudioMessage","onVideoMessage","onFileMessage","onLocationMessage","onCmdMessage","onPresence","onRoster","onReceivedMessage","onInviteMessage","onOffline","onOnline","onConfirmPop","onUpdateMyGroupList","onUpdateMyRoster","onBlacklistUpdate","isNeed","navigator","userAgent","heartBeatID","ping","clearInterval","dom","$msg","xmlns","sendCommand","tree","cacheReceiptsMessage","host","getXmlFirstChild","ip","port","parter","Connection","getHostsByTag","tagName","tag","hosts","getRestFromHttpDNS","login","self","suc","res","options2","dataType","app_key","encodeURIComponent","success","ajax","EMPTYFN","err","restUrl","userjson","username","password","nickname","userinfo","open","pass","pwd","STATUS_DOLOGIN_IM","restTokenData","error_description","WEBIM_CONNCTION_OPEN_ERROR","STATUS_DOLOGIN_USERGRID","loginJson","grant_type","timestamp","loginfo","attach","WEBIM_CONNCTION_TOKEN_NOT_ASSIGN_ERROR","sid","WEBIM_CONNCTION_SESSIONID_NOT_ASSIGN_ERROR","rid","WEBIM_CONNCTION_RID_NOT_ASSIGN_ERROR","wind","reason","isClosed","isClosing","disconnect","handler","ns","fail","$iq","t","up","failFn","ele","WEBIM_CONNCTION_NOTIFYVERSION_ERROR","sendIQ","presence_type","fromUser","toUser","info","fromJid","chatroom","showTags","showTag","show","statusTags","statusTag","priorityTags","priorityTag","priority","destroy","members","member","role","kickedMember","actor","actorNick","kicked","toNick","groupJid","userJid","groupName","original_type","reflectUser","slice","lastIndexOf","getBlacklist","curJid","iqresult","errorCode","errorText","errorBool","textDOM","msgDatas","too","extmsg","ext","chattype","typeEl","bodies","receiveMsg","emojibody","parseTextMessage","Emoji","isemoji","delay","rwidth","rheight","size","width","height","substr","secret","filename","thumb","thumb_secret","file_length","filetype","addr","lat","lng","action","WEBIM_CONNCTION_CALLBACK_INNER_ERROR","mid","rcv","innerHTML","innerText","Function","form","invitemsg","reasonDom","reasonMsg","xmsg","roomid","roomjid","getUniqueId","cdate","offdate","offset","hexd","parseInt","toString","doQuery","encodeURI","chatType","response","WEBIM_MESSAGE_SED_ERROR","Object","addRoster","removeRoster","getRoster","completeFn","WEBIM_CONNCTION_GETROSTER_ERROR","pres","$pres","unsubscribe","unsubscribed","joinPublicGroup","room_nick","errorFn","WEBIM_CONNCTION_JOINROOM_ERROR","NS","MUC","listRooms","server","DISCO_ITEMS","WEBIM_CONNCTION_GETROOM_ERROR","queryRoomMember","mem","WEBIM_CONNCTION_GETROOMMEMBER_ERROR","queryRoomInfo","DISCO_INFO","settings","features","fields","fieldValues","field","fieldVar","fieldSimplify","WEBIM_CONNCTION_GETROOMINFO_ERROR","queryRoomOccupants","WEBIM_CONNCTION_GETROOMOCCUPANTS_ERROR","attrs","setUserSig","desc","getPresence","WEBIM_CONNCTION_PING_ERROR","key","errorType","WEBIM_CONNCTION_CLIENT_LOGOUT","getChatRooms","isCanSetRequestHeader","WEBIM_CONNCTION_NOT_SUPPORT_CHATROOM_ERROR","token","WEBIM_CONNCTION_LOAD_CHATROOM_ERROR","pageInfo","pagenum","pagesize","opts","headers","Authorization","joinChatRoom","WEBIM_CONNCTION_JOINCHATROOM_ERROR","quitChatRoom","WEBIM_CONNCTION_QUITCHATROOM_ERROR","_onReceiveInviteFromGroup","title","group_id","agree","WEBIM_CONNECTION_ACCEPT_INVITATION_FROM_GROUP","reject","WEBIM_CONNECTION_DECLINE_INVITATION_FROM_GROUP","_onReceiveInviteAcceptionFromGroup","_onReceiveInviteDeclineFromGroup","_onAutoAcceptInvitationFromGroup","group_name","_onLeaveGroup","_onReceiveJoinGroupApplication","WEBIM_CONNECTION_ACCEPT_JOIN_GROUP","WEBIM_CONNECTION_DECLINE_JOIN_GROUP","_onReceiveAcceptionFromGroup","_onReceiveRejectionFromGroup","_onUpdateMyGroupList","_onUpdateMyRoster","that","closed","WEBIM_CONNECTION_CLOSED","sucFn","errFn","addToBlackList","blacklist","piece","keys","len","value","removeFromBlackList","_getGroupJid","addToGroupBlackList","getGroupBlacklist","removeGroupMemberFromBlacklist","changeGroupSubject","var","subject","description","destroyGroup","leaveGroupBySelf","msgInfo","errInfo","leaveGroup","addGroupMembers","acceptInviteFromGroup","rejectInviteFromGroup","createGroup","toRoom","x","setAttribute","optionsPublic","optionsMembersOnly","optionsModerate","optionsAllowInvites","cnode","statusCode","str","cefQuery","request","persistent","onSuccess","onFailure","WEBIM_CONNCTION_ATTACH_ERROR","WEBIM_CONNCTION_ATTACH_USERGRID_ERROR","WEBIM_CONNCTION_REOPEN_ERROR","WEBIM_CONNCTION_IQ_ERROR","WEBIM_CONNCTION_CROSSDOMAIN_ERROR","WEBIM_CONNCTION_LISTENING_OUTOF_MAXRETRIES","WEBIM_CONNCTION_RECEIVEMSG_CONTENTERROR","WEBIM_CONNCTION_AJAX_ERROR","WEBIM_CONNCTION_CLIENT_OFFLINE","WEBIM_CONNCTION_CLIENT_TOO_MUCH_ERROR","WEBIM_UPLOADFILE_BROWSER_ERROR","WEBIM_UPLOADFILE_ERROR","WEBIM_UPLOADFILE_NO_LOGIN","WEBIM_UPLOADFILE_NO_FILE","WEBIM_DOWNLOADFILE_ERROR","WEBIM_DOWNLOADFILE_NO_LOGIN","WEBIM_DOWNLOADFILE_BROWSER_ERROR","WEBIM_MESSAGE_REC_TEXT_ERROR","WEBIM_MESSAGE_REC_EMOTION","WEBIM_MESSAGE_REC_AUDIO","WEBIM_MESSAGE_REC_VEDIO","WEBIM_MESSAGE_REC_VEDIO_FILE","WEBIM_MESSAGE_REC_FILE","WEBIM_MESSAGE_SED_EMOTION","WEBIM_MESSAGE_SED_PHOTO","WEBIM_MESSAGE_SED_AUDIO","WEBIM_MESSAGE_SED_AUDIO_FILE","WEBIM_MESSAGE_SED_VEDIO","WEBIM_MESSAGE_SED_VEDIO_FILE","WEBIM_MESSAGE_SED_FILE","WEBIM_FILESIZE_LIMIT","_createStandardXHR","XMLHttpRequest","_createActiveXHR","ActiveXObject","_xmlrequest","crossDomain","temp","onload","xmlDoc","async","loadXML","responseText","responseXML","ontimeout","onerror","_hasFlash","ex","plugins","_tmpUtilXHR","_hasFormData","FormData","_hasBlob","Blob","_isCanSetRequestHeader","setRequestHeader","_hasOverrideMimeType","_isCanUploadFileAsync","_isCanUploadFile","_isCanDownLoadFile","hasDontEnumBug","propertyIsEnumerable","dontEnums","dontEnumsLength","obj","TypeError","prop","hasFormData","hasBlob","hasOverrideMimeType","isCanUploadFileAsync","notSupportList","ua","l","getIEVersion","matches","tridentMap","4","5","6","7","match","json","JSON","s","arr","iterate","isArr","o","getFileUrl","fileInputId","uri","fileObj","getElementById","createObjectURL","fileItems","files","u","pos1","pos2","pos","max","index","getFileSize","file","fileSize","select","fileobject","GetFile","Size","kb","round","mb","gb","hasFlash","trim","parseEmoji","map","emoji","face","path","parseLink","reg","parseJSON","parse","requireNonComma","depth","comma","parseUploadResponse","parseDownloadResponse","uploadFile","onFileUploadProgress","onFileUploadComplete","onFileUploadError","onFileUploadCanceled","acc","uploadUrl","flashUpload","undefined","upload","abort","formData","append","download","onFileDownloadComplete","onFileDownloadError","method","resType","responseType","mimeType","innerHeaer","X-Requested-With","Accept","share-secret","faces","emessage","expr","tmsg","existEmoji","emojiStr","restMsgIndex","children","tempData","d","Hours","getHours","Minutes","getMinutes","Seconds","getSeconds","Milliseconds","getMilliseconds","getObjectKey","val","Message","setGroup","txt","set","opt","roomType","cmd","img","uploadError","uploadComplete","audio","video","_Message","_send","weichat","originType","jsonstr","_tmpComplete","_complete","entities","file_len","thumbnail","Array_h","array","Array","at","start","end","concat","remove","count","splice","join","separator","_array_h","_index","ret","head","tail","empty"],"mappings":"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","file":"websdk-1.4.6.min.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"WebIM\"] = factory();\n\telse\n\t\troot[\"WebIM\"] = factory();\n})(this, function() {\nreturn /******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId])\n/******/ \t\t\treturn installedModules[moduleId].exports;\n\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\texports: {},\n/******/ \t\t\tid: moduleId,\n/******/ \t\t\tloaded: false\n/******/ \t\t};\n\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.loaded = true;\n\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n\n\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(0);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tmodule.exports = __webpack_require__(1)\n\n\n/***/ },\n/* 1 */\n/***/ function(module, exports, __webpack_require__) {\n\n\tvar _version = '1.4.2';\n\tvar _code = __webpack_require__(2).code;\n\tvar _utils = __webpack_require__(3).utils;\n\tvar _msg = __webpack_require__(4);\n\tvar _message = _msg._msg;\n\tvar _msgHash = {};\n\tvar Queue = __webpack_require__(5).Queue;\n\n\twindow.URL = window.URL || window.webkitURL || window.mozURL || window.msURL;\n\n\tif (window.XDomainRequest) {\n\t    XDomainRequest.prototype.oldsend = XDomainRequest.prototype.send;\n\t    XDomainRequest.prototype.send = function () {\n\t        XDomainRequest.prototype.oldsend.apply(this, arguments);\n\t        this.readyState = 2;\n\t    };\n\t}\n\n\tStrophe.Request.prototype._newXHR = function () {\n\t    var xhr = _utils.xmlrequest(true);\n\t    if (xhr.overrideMimeType) {\n\t        xhr.overrideMimeType('text/xml');\n\t    }\n\t    // use Function.bind() to prepend ourselves as an argument\n\t    xhr.onreadystatechange = this.func.bind(null, this);\n\t    return xhr;\n\t};\n\n\tStrophe.Websocket.prototype._closeSocket = function () {\n\t    if (this.socket) {\n\t        var me = this;\n\t        setTimeout(function () {\n\t            try {\n\t                me.socket.close();\n\t            } catch (e) {\n\t            }\n\t        }, 0);\n\t    } else {\n\t        this.socket = null;\n\t    }\n\t};\n\n\t/**\n\t *\n\t * Strophe.Websocket has a bug while logout:\n\t * 1.send: <presence xmlns='jabber:client' type='unavailable'/> is ok;\n\t * 2.send: <close xmlns='urn:ietf:params:xml:ns:xmpp-framing'/> will cause a problem,log as follows:\n\t * WebSocket connection to 'ws://im-api.easemob.com/ws/' failed: Data frame received after close_connect @ strophe.js:5292connect @ strophe.js:2491_login @ websdk-1.1.2.js:278suc @ websdk-1.1.2.js:636xhr.onreadystatechange @ websdk-1.1.2.js:2582\n\t * 3 \"Websocket error [object Event]\"\n\t * _changeConnectStatus\n\t * onError Object {type: 7, msg: \"The WebSocket connection could not be established or was disconnected.\", reconnect: true}\n\t *\n\t * this will trigger socket.onError, therefore _doDisconnect again.\n\t * Fix it by overide  _onMessage\n\t */\n\tStrophe.Websocket.prototype._onMessage = function (message) {\n\t    WebIM && WebIM.config.isDebug && console.log(WebIM.utils.ts() + 'recv:', message.data);\n\t    var elem, data;\n\t    // check for closing stream\n\t    // var close = '<close xmlns=\"urn:ietf:params:xml:ns:xmpp-framing\" />';\n\t    // if (message.data === close) {\n\t    //     this._conn.rawInput(close);\n\t    //     this._conn.xmlInput(message);\n\t    //     if (!this._conn.disconnecting) {\n\t    //         this._conn._doDisconnect();\n\t    //     }\n\t    //     return;\n\t    //\n\t    // send and receive close xml: <close xmlns='urn:ietf:params:xml:ns:xmpp-framing'/>\n\t    // so we can't judge whether message.data equals close by === simply.\n\t    if (message.data.indexOf(\"<close \") === 0) {\n\t        elem = new DOMParser().parseFromString(message.data, \"text/xml\").documentElement;\n\t        var see_uri = elem.getAttribute(\"see-other-uri\");\n\t        if (see_uri) {\n\t            this._conn._changeConnectStatus(Strophe.Status.REDIRECT, \"Received see-other-uri, resetting connection\");\n\t            this._conn.reset();\n\t            this._conn.service = see_uri;\n\t            this._connect();\n\t        } else {\n\t            // if (!this._conn.disconnecting) {\n\t            this._conn._doDisconnect(\"receive <close> from server\");\n\t            // }\n\t        }\n\t        return;\n\t    } else if (message.data.search(\"<open \") === 0) {\n\t        // This handles stream restarts\n\t        elem = new DOMParser().parseFromString(message.data, \"text/xml\").documentElement;\n\t        if (!this._handleStreamStart(elem)) {\n\t            return;\n\t        }\n\t    } else {\n\t        data = this._streamWrap(message.data);\n\t        elem = new DOMParser().parseFromString(data, \"text/xml\").documentElement;\n\t    }\n\n\t    if (this._check_streamerror(elem, Strophe.Status.ERROR)) {\n\t        return;\n\t    }\n\n\t    //handle unavailable presence stanza before disconnecting\n\t    if (this._conn.disconnecting &&\n\t        elem.firstChild.nodeName === \"presence\" &&\n\t        elem.firstChild.getAttribute(\"type\") === \"unavailable\") {\n\t        this._conn.xmlInput(elem);\n\t        this._conn.rawInput(Strophe.serialize(elem));\n\t        // if we are already disconnecting we will ignore the unavailable stanza and\n\t        // wait for the </stream:stream> tag before we close the connection\n\t        return;\n\t    }\n\t    this._conn._dataRecv(elem, message.data);\n\t};\n\n\n\tvar _listenNetwork = function (onlineCallback, offlineCallback) {\n\n\t    if (window.addEventListener) {\n\t        window.addEventListener('online', onlineCallback);\n\t        window.addEventListener('offline', offlineCallback);\n\n\t    } else if (window.attachEvent) {\n\t        if (document.body) {\n\t            document.body.attachEvent('ononline', onlineCallback);\n\t            document.body.attachEvent('onoffline', offlineCallback);\n\t        } else {\n\t            window.attachEvent('load', function () {\n\t                document.body.attachEvent('ononline', onlineCallback);\n\t                document.body.attachEvent('onoffline', offlineCallback);\n\t            });\n\t        }\n\t    } else {\n\t        /*var onlineTmp = window.ononline;\n\t         var offlineTmp = window.onoffline;\n\n\t         window.attachEvent('ononline', function () {\n\t         try {\n\t         typeof onlineTmp === 'function' && onlineTmp();\n\t         } catch ( e ) {}\n\t         onlineCallback();\n\t         });\n\t         window.attachEvent('onoffline', function () {\n\t         try {\n\t         typeof offlineTmp === 'function' && offlineTmp();\n\t         } catch ( e ) {}\n\t         offlineCallback();\n\t         });*/\n\t    }\n\t};\n\n\tvar _parseRoom = function (result) {\n\t    var rooms = [];\n\t    var items = result.getElementsByTagName('item');\n\t    if (items) {\n\t        for (var i = 0; i < items.length; i++) {\n\t            var item = items[i];\n\t            var roomJid = item.getAttribute('jid');\n\t            var tmp = roomJid.split('@')[0];\n\t            var room = {\n\t                jid: roomJid,\n\t                name: item.getAttribute('name'),\n\t                roomId: tmp.split('_')[1]\n\t            };\n\t            rooms.push(room);\n\t        }\n\t    }\n\t    return rooms;\n\t};\n\n\tvar _parseRoomOccupants = function (result) {\n\t    var occupants = [];\n\t    var items = result.getElementsByTagName('item');\n\t    if (items) {\n\t        for (var i = 0; i < items.length; i++) {\n\t            var item = items[i];\n\t            var room = {\n\t                jid: item.getAttribute('jid'),\n\t                name: item.getAttribute('name')\n\t            };\n\t            occupants.push(room);\n\t        }\n\t    }\n\t    return occupants;\n\t};\n\n\tvar _parseResponseMessage = function (msginfo) {\n\t    var parseMsgData = {errorMsg: true, data: []};\n\n\t    var msgBodies = msginfo.getElementsByTagName('body');\n\t    if (msgBodies) {\n\t        for (var i = 0; i < msgBodies.length; i++) {\n\t            var msgBody = msgBodies[i];\n\t            var childNodes = msgBody.childNodes;\n\t            if (childNodes && childNodes.length > 0) {\n\t                var childNode = msgBody.childNodes[0];\n\t                if (childNode.nodeType == Strophe.ElementType.TEXT) {\n\t                    var jsondata = childNode.wholeText || childNode.nodeValue;\n\t                    jsondata = jsondata.replace('\\n', '<br>');\n\t                    try {\n\t                        var data = eval('(' + jsondata + ')');\n\t                        parseMsgData.errorMsg = false;\n\t                        parseMsgData.data = [data];\n\t                    } catch (e) {\n\t                    }\n\t                }\n\t            }\n\t        }\n\n\t        var delayTags = msginfo.getElementsByTagName('delay');\n\t        if (delayTags && delayTags.length > 0) {\n\t            var delayTag = delayTags[0];\n\t            var delayMsgTime = delayTag.getAttribute('stamp');\n\t            if (delayMsgTime) {\n\t                parseMsgData.delayTimeStamp = delayMsgTime;\n\t            }\n\t        }\n\t    } else {\n\t        var childrens = msginfo.childNodes;\n\t        if (childrens && childrens.length > 0) {\n\t            var child = msginfo.childNodes[0];\n\t            if (child.nodeType == Strophe.ElementType.TEXT) {\n\t                try {\n\t                    var data = eval('(' + child.nodeValue + ')');\n\t                    parseMsgData.errorMsg = false;\n\t                    parseMsgData.data = [data];\n\t                } catch (e) {\n\t                }\n\t            }\n\t        }\n\t    }\n\t    return parseMsgData;\n\t};\n\n\tvar _parseNameFromJidFn = function (jid, domain) {\n\t    domain = domain || '';\n\t    var tempstr = jid;\n\t    var findex = tempstr.indexOf('_');\n\n\t    if (findex !== -1) {\n\t        tempstr = tempstr.substring(findex + 1);\n\t    }\n\t    var atindex = tempstr.indexOf('@' + domain);\n\t    if (atindex !== -1) {\n\t        tempstr = tempstr.substring(0, atindex);\n\t    }\n\t    return tempstr;\n\t};\n\n\tvar _parseFriend = function (queryTag, conn, from) {\n\t    var rouster = [];\n\t    var items = queryTag.getElementsByTagName('item');\n\t    if (items) {\n\t        for (var i = 0; i < items.length; i++) {\n\t            var item = items[i];\n\t            var jid = item.getAttribute('jid');\n\t            if (!jid) {\n\t                continue;\n\t            }\n\t            var subscription = item.getAttribute('subscription');\n\t            var friend = {\n\t                subscription: subscription,\n\t                jid: jid\n\t            };\n\t            var ask = item.getAttribute('ask');\n\t            if (ask) {\n\t                friend.ask = ask;\n\t            }\n\t            var name = item.getAttribute('name');\n\t            if (name) {\n\t                friend.name = name;\n\t            } else {\n\t                var n = _parseNameFromJidFn(jid);\n\t                friend.name = n;\n\t            }\n\t            var groups = [];\n\t            Strophe.forEachChild(item, 'group', function (group) {\n\t                groups.push(Strophe.getText(group));\n\t            });\n\t            friend.groups = groups;\n\t            rouster.push(friend);\n\t            // B同意之后 -> B订阅A\n\t            if (conn && (subscription == 'from')) {\n\t                conn.subscribe({\n\t                    toJid: jid\n\t                });\n\t            }\n\n\t            if (conn && (subscription == 'to')) {\n\t                conn.subscribed({\n\t                    toJid: jid\n\t                });\n\t            }\n\t        }\n\t    }\n\t    return rouster;\n\t};\n\n\tvar _login = function (options, conn) {\n\t    var accessToken = options.access_token || '';\n\t    if (accessToken == '') {\n\t        var loginfo = _utils.stringify(options);\n\t        conn.onError({\n\t            type: _code.WEBIM_CONNCTION_OPEN_USERGRID_ERROR,\n\t            data: options\n\t        });\n\t        return;\n\t    }\n\t    conn.context.accessToken = options.access_token;\n\t    conn.context.accessTokenExpires = options.expires_in;\n\t    var stropheConn = null;\n\t    if (conn.isOpening() && conn.context.stropheConn) {\n\t        stropheConn = conn.context.stropheConn;\n\t    } else if (conn.isOpened() && conn.context.stropheConn) {\n\t        // return;\n\t        stropheConn = conn.getStrophe();\n\t    } else {\n\t        stropheConn = conn.getStrophe();\n\t    }\n\t    var callback = function (status, msg) {\n\t        _loginCallback(status, msg, conn);\n\t    };\n\n\t    conn.context.stropheConn = stropheConn;\n\t    if (conn.route) {\n\t        stropheConn.connect(conn.context.jid, '$t$' + accessToken, callback, conn.wait, conn.hold, conn.route);\n\t    } else {\n\t        stropheConn.connect(conn.context.jid, '$t$' + accessToken, callback, conn.wait, conn.hold);\n\t    }\n\t};\n\n\tvar _parseMessageType = function (msginfo) {\n\t    var msgtype = 'normal';\n\t    var receiveinfo = msginfo.getElementsByTagName('received');\n\t    if (receiveinfo && receiveinfo.length > 0 && receiveinfo[0].namespaceURI === 'urn:xmpp:receipts') {\n\t        msgtype = 'received';\n\t    } else {\n\t        var inviteinfo = msginfo.getElementsByTagName('invite');\n\t        if (inviteinfo && inviteinfo.length > 0) {\n\t            msgtype = 'invite';\n\t        }\n\t    }\n\t    return msgtype;\n\t};\n\n\tvar _handleMessageQueue = function (conn) {\n\t    for (var i in _msgHash) {\n\t        if (_msgHash.hasOwnProperty(i)) {\n\t            _msgHash[i].send(conn);\n\t        }\n\t    }\n\t};\n\n\tvar _loginCallback = function (status, msg, conn) {\n\t    var conflict, error;\n\n\t    if (msg === 'conflict') {\n\t        conflict = true;\n\t    }\n\n\t    if (status == Strophe.Status.CONNFAIL) {\n\t        //client offline, ping/pong timeout, server quit, server offline\n\t        error = {\n\t            type: _code.WEBIM_CONNCTION_SERVER_CLOSE_ERROR,\n\t            msg: msg,\n\t            reconnect: true\n\t        };\n\n\t        conflict && (error.conflict = true);\n\t        conn.onError(error);\n\t    } else if (status == Strophe.Status.ATTACHED || status == Strophe.Status.CONNECTED) {\n\t        // client should limit the speed of sending ack messages  up to 5/s\n\t        conn.intervalId = setInterval(function () {\n\t            conn.handelSendQueue();\n\t        }, 200);\n\t        var handleMessage = function (msginfo) {\n\t            var type = _parseMessageType(msginfo);\n\n\t            if ('received' === type) {\n\t                conn.handleReceivedMessage(msginfo);\n\t                return true;\n\t            } else if ('invite' === type) {\n\t                conn.handleInviteMessage(msginfo);\n\t                return true;\n\t            } else {\n\t                conn.handleMessage(msginfo);\n\t                return true;\n\t            }\n\t        };\n\t        var handlePresence = function (msginfo) {\n\t            conn.handlePresence(msginfo);\n\t            return true;\n\t        };\n\t        var handlePing = function (msginfo) {\n\t            conn.handlePing(msginfo);\n\t            return true;\n\t        };\n\t        var handleIqRoster = function (msginfo) {\n\t            conn.handleIqRoster(msginfo);\n\t            return true;\n\t        };\n\t        var handleIqPrivacy = function (msginfo) {\n\t            conn.handleIqPrivacy(msginfo);\n\t            return true;\n\t        };\n\t        var handleIq = function (msginfo) {\n\t            conn.handleIq(msginfo);\n\t            return true;\n\t        };\n\n\t        conn.addHandler(handleMessage, null, 'message', null, null, null);\n\t        conn.addHandler(handlePresence, null, 'presence', null, null, null);\n\t        conn.addHandler(handlePing, 'urn:xmpp:ping', 'iq', 'get', null, null);\n\t        conn.addHandler(handleIqRoster, 'jabber:iq:roster', 'iq', 'set', null, null);\n\t        conn.addHandler(handleIqPrivacy, 'jabber:iq:privacy', 'iq', 'set', null, null);\n\t        conn.addHandler(handleIq, null, 'iq', null, null, null);\n\n\t        conn.context.status = _code.STATUS_OPENED;\n\n\t        var supportRecMessage = [\n\t            _code.WEBIM_MESSAGE_REC_TEXT,\n\t            _code.WEBIM_MESSAGE_REC_EMOJI];\n\n\t        if (_utils.isCanDownLoadFile) {\n\t            supportRecMessage.push(_code.WEBIM_MESSAGE_REC_PHOTO);\n\t            supportRecMessage.push(_code.WEBIM_MESSAGE_REC_AUDIO_FILE);\n\t        }\n\t        var supportSedMessage = [_code.WEBIM_MESSAGE_SED_TEXT];\n\t        if (_utils.isCanUploadFile) {\n\t            supportSedMessage.push(_code.WEBIM_MESSAGE_REC_PHOTO);\n\t            supportSedMessage.push(_code.WEBIM_MESSAGE_REC_AUDIO_FILE);\n\t        }\n\t        conn.notifyVersion();\n\t        conn.retry && _handleMessageQueue(conn);\n\t        conn.heartBeat();\n\t        conn.isAutoLogin && conn.setPresence();\n\t        conn.onOpened({\n\t            canReceive: supportRecMessage,\n\t            canSend: supportSedMessage,\n\t            accessToken: conn.context.accessToken\n\t        });\n\t    } else if (status == Strophe.Status.DISCONNECTING) {\n\t        if (conn.isOpened()) {\n\t            conn.stopHeartBeat();\n\t            conn.context.status = _code.STATUS_CLOSING;\n\n\t            error = {\n\t                type: _code.WEBIM_CONNCTION_SERVER_CLOSE_ERROR,\n\t                msg: msg,\n\t                reconnect: true\n\t            };\n\n\t            conflict && (error.conflict = true);\n\t            conn.onError(error);\n\t        }\n\t    } else if (status == Strophe.Status.DISCONNECTED) {\n\t        if (conn.isOpened()) {\n\t            if (conn.autoReconnectNumTotal < conn.autoReconnectNumMax) {\n\t                conn.reconnect();\n\t                return;\n\t            } else {\n\t                error = {\n\t                    type: _code.WEBIM_CONNCTION_DISCONNECTED\n\t                };\n\t                conn.onError(error);\n\t            }\n\t        }\n\t        conn.context.status = _code.STATUS_CLOSED;\n\t        conn.clear();\n\t        conn.onClosed();\n\t    } else if (status == Strophe.Status.AUTHFAIL) {\n\t        error = {\n\t            type: _code.WEBIM_CONNCTION_AUTH_ERROR\n\t        };\n\n\t        conflict && (error.conflict = true);\n\t        conn.onError(error);\n\t        conn.clear();\n\t    } else if (status == Strophe.Status.ERROR) {\n\t        conn.context.status = _code.STATUS_ERROR;\n\t        error = {\n\t            type: _code.WEBIM_CONNCTION_SERVER_ERROR\n\t        };\n\n\t        conflict && (error.conflict = true);\n\t        conn.onError(error);\n\t    }\n\t    conn.context.status_now = status;\n\t};\n\n\tvar _getJid = function (options, conn) {\n\t    var jid = options.toJid || '';\n\n\t    if (jid === '') {\n\t        var appKey = conn.context.appKey || '';\n\t        var toJid = appKey + '_' + options.to + '@' + conn.domain;\n\n\t        if (options.resource) {\n\t            toJid = toJid + '/' + options.resource;\n\t        }\n\t        jid = toJid;\n\t    }\n\t    return jid;\n\t};\n\n\tvar _getJidByName = function (name, conn) {\n\t    var options = {\n\t        to: name\n\t    };\n\t    return _getJid(options, conn);\n\t};\n\n\tvar _validCheck = function (options, conn) {\n\t    options = options || {};\n\n\t    if (options.user == '') {\n\t        conn.onError({\n\t            type: _code.WEBIM_CONNCTION_USER_NOT_ASSIGN_ERROR\n\t        });\n\t        return false;\n\t    }\n\n\t    var user = (options.user + '') || '';\n\t    var appKey = options.appKey || '';\n\t    var devInfos = appKey.split('#');\n\n\t    if (devInfos.length !== 2) {\n\t        conn.onError({\n\t            type: _code.WEBIM_CONNCTION_APPKEY_NOT_ASSIGN_ERROR\n\t        });\n\t        return false;\n\t    }\n\t    var orgName = devInfos[0];\n\t    var appName = devInfos[1];\n\n\t    if (!orgName) {\n\t        conn.onError({\n\t            type: _code.WEBIM_CONNCTION_APPKEY_NOT_ASSIGN_ERROR\n\t        });\n\t        return false;\n\t    }\n\t    if (!appName) {\n\t        conn.onError({\n\t            type: _code.WEBIM_CONNCTION_APPKEY_NOT_ASSIGN_ERROR\n\t        });\n\t        return false;\n\t    }\n\n\t    var jid = appKey + '_' + user.toLowerCase() + '@' + conn.domain,\n\t        resource = options.resource || 'webim';\n\n\t    if (conn.isMultiLoginSessions) {\n\t        resource += user + new Date().getTime() + Math.floor(Math.random().toFixed(6) * 1000000);\n\t    }\n\t    conn.context.jid = jid + '/' + resource;\n\t    /*jid: {appkey}_{username}@domain/resource*/\n\t    conn.context.userId = user;\n\t    conn.context.appKey = appKey;\n\t    conn.context.appName = appName;\n\t    conn.context.orgName = orgName;\n\n\t    return true;\n\t};\n\n\tvar _getXmppUrl = function (baseUrl, https) {\n\t    if (/^(ws|http)s?:\\/\\/?/.test(baseUrl)) {\n\t        return baseUrl;\n\t    }\n\n\t    var url = {\n\t        prefix: 'http',\n\t        base: '://' + baseUrl,\n\t        suffix: '/http-bind/'\n\t    };\n\n\t    if (https && _utils.isSupportWss) {\n\t        url.prefix = 'wss';\n\t        url.suffix = '/ws/';\n\t    } else {\n\t        if (https) {\n\t            url.prefix = 'https';\n\t        } else if (window.WebSocket) {\n\t            url.prefix = 'ws';\n\t            url.suffix = '/ws/';\n\t        }\n\t    }\n\n\t    return url.prefix + url.base + url.suffix;\n\t};\n\n\n\t//class\n\tvar connection = function (options) {\n\t    if (!this instanceof connection) {\n\t        return new connection(options);\n\t    }\n\n\t    var options = options || {};\n\n\t    this.isHttpDNS = options.isHttpDNS || false;\n\t    this.isMultiLoginSessions = options.isMultiLoginSessions || false;\n\t    this.wait = options.wait || 30;\n\t    this.retry = options.retry || false;\n\t    this.https = options.https || location.protocol === 'https:';\n\t    this.url = _getXmppUrl(options.url, this.https);\n\t    this.hold = options.hold || 1;\n\t    this.route = options.route || null;\n\t    this.domain = options.domain || 'easemob.com';\n\t    this.inactivity = options.inactivity || 30;\n\t    this.heartBeatWait = options.heartBeatWait || 4500;\n\t    this.maxRetries = options.maxRetries || 5;\n\t    this.isAutoLogin = options.isAutoLogin === false ? false : true;\n\t    this.pollingTime = options.pollingTime || 800;\n\t    this.stropheConn = false;\n\t    this.autoReconnectNumMax = options.autoReconnectNumMax || 0;\n\t    this.autoReconnectNumTotal = 0;\n\t    this.autoReconnectInterval = options.autoReconnectInterval || 0;\n\t    this.context = {status: _code.STATUS_INIT};\n\t    this.sendQueue = new Queue();  //instead of sending message immediately,cache them in this queue\n\t    this.intervalId = null;   //clearInterval return value\n\t    this.apiUrl = options.apiUrl || '';\n\t    this.isWindowSDK = options.isWindowSDK || false;\n\n\t    this.dnsArr = ['https://rs.easemob.com', 'https://rsbak.easemob.com', 'http://182.92.174.78', 'http://112.126.66.111']; //http dns server hosts\n\t    this.dnsIndex = 0;   //the dns ip used in dnsArr currently\n\t    this.dnsTotal = this.dnsArr.length;  //max number of getting dns retries\n\t    this.restHosts = null; //rest server ips\n\t    this.restIndex = 0;    //the rest ip used in restHosts currently\n\t    this.restTotal = 0;    //max number of getting rest token retries\n\t    this.xmppHosts = null; //xmpp server ips\n\t    this.xmppIndex = 0;    //the xmpp ip used in xmppHosts currently\n\t    this.xmppTotal = 0;    //max number of creating xmpp server connection(ws/bosh) retries\n\t};\n\n\tconnection.prototype.registerUser = function (options){\n\t    if (location.protocol != 'https:' && this.isHttpDNS) {\n\t        this.dnsIndex = 0;\n\t        this.getHttpDNS(options, 'signup');\n\t    } else {\n\t        this.signup(options);\n\t    }\n\t}\n\n\tconnection.prototype.handelSendQueue = function () {\n\t    var options = this.sendQueue.pop();\n\t    if (options !== null) {\n\t        this.sendReceiptsMessage(options);\n\t    }\n\t};\n\tconnection.prototype.listen = function (options) {\n\t    this.onOpened = options.onOpened || _utils.emptyfn;\n\t    this.onClosed = options.onClosed || _utils.emptyfn;\n\t    this.onTextMessage = options.onTextMessage || _utils.emptyfn;\n\t    this.onEmojiMessage = options.onEmojiMessage || _utils.emptyfn;\n\t    this.onPictureMessage = options.onPictureMessage || _utils.emptyfn;\n\t    this.onAudioMessage = options.onAudioMessage || _utils.emptyfn;\n\t    this.onVideoMessage = options.onVideoMessage || _utils.emptyfn;\n\t    this.onFileMessage = options.onFileMessage || _utils.emptyfn;\n\t    this.onLocationMessage = options.onLocationMessage || _utils.emptyfn;\n\t    this.onCmdMessage = options.onCmdMessage || _utils.emptyfn;\n\t    this.onPresence = options.onPresence || _utils.emptyfn;\n\t    this.onRoster = options.onRoster || _utils.emptyfn;\n\t    this.onError = options.onError || _utils.emptyfn;\n\t    this.onReceivedMessage = options.onReceivedMessage || _utils.emptyfn;\n\t    this.onInviteMessage = options.onInviteMessage || _utils.emptyfn;\n\t    this.onOffline = options.onOffline || _utils.emptyfn;\n\t    this.onOnline = options.onOnline || _utils.emptyfn;\n\t    this.onConfirmPop = options.onConfirmPop || _utils.emptyfn;\n\t    //for WindowSDK start\n\t    this.onUpdateMyGroupList = options.onUpdateMyGroupList || _utils.emptyfn;\n\t    this.onUpdateMyRoster = options.onUpdateMyRoster || _utils.emptyfn;\n\t    //for WindowSDK end\n\t    this.onBlacklistUpdate = options.onBlacklistUpdate || _utils.emptyfn;\n\n\t    _listenNetwork(this.onOnline, this.onOffline);\n\t};\n\n\tconnection.prototype.heartBeat = function () {\n\t    var me = this;\n\t    //IE8: strophe auto switch from ws to BOSH, need heartbeat\n\t    var isNeed = !/^ws|wss/.test(me.url) || /mobile/.test(navigator.userAgent);\n\n\t    if (this.heartBeatID || !isNeed) {\n\t        return;\n\t    }\n\n\t    var options = {\n\t        toJid: this.domain,\n\t        type: 'normal'\n\t    };\n\t    this.heartBeatID = setInterval(function () {\n\t        me.ping(options);\n\t    }, this.heartBeatWait);\n\t};\n\n\tconnection.prototype.stopHeartBeat = function () {\n\t    if (typeof this.heartBeatID == \"number\") {\n\t        this.heartBeatID = clearInterval(this.heartBeatID);\n\t    }\n\t};\n\n\tconnection.prototype.sendReceiptsMessage = function (options) {\n\t    var dom = $msg({\n\t        from: this.context.jid || '',\n\t        to: this.domain,\n\t        id: options.id || ''\n\t    }).c('received', {\n\t        xmlns: 'urn:xmpp:receipts',\n\t        id: options.id || ''\n\t    });\n\t    this.sendCommand(dom.tree());\n\t};\n\n\tconnection.prototype.cacheReceiptsMessage = function (options) {\n\t    this.sendQueue.push(options);\n\t};\n\n\tconnection.prototype.getStrophe = function () {\n\t    if (location.protocol != 'https:' && this.isHttpDNS) {\n\t        //TODO: try this.xmppTotal times on fail\n\t        var url = '';\n\t        var host = this.xmppHosts[this.xmppIndex];\n\t        var domain = _utils.getXmlFirstChild(host, 'domain');\n\t        var ip = _utils.getXmlFirstChild(host, 'ip');\n\t        if (ip) {\n\t            url = ip.textContent;\n\t            var port = _utils.getXmlFirstChild(host, 'port');\n\t            if (port.textContent != '80') {\n\t                url += ':' + port.textContent;\n\t            }\n\t        } else {\n\t            url = domain.textContent;\n\t        }\n\n\t        if (url != '') {\n\t            var parter = /(.+\\/\\/).+(\\/.+)/;\n\t            this.url = this.url.replace(parter, \"$1\" + url + \"$2\");\n\t        }\n\t    }\n\n\t    var stropheConn = new Strophe.Connection(this.url, {\n\t        inactivity: this.inactivity,\n\t        maxRetries: this.maxRetries,\n\t        pollingTime: this.pollingTime\n\t    });\n\t    return stropheConn;\n\t};\n\tconnection.prototype.getHostsByTag = function (data, tagName) {\n\t    var tag = _utils.getXmlFirstChild(data, tagName);\n\t    if (!tag) {\n\t        console.log(tagName + ' hosts error');\n\t        return null;\n\t    }\n\t    var hosts = tag.getElementsByTagName('hosts');\n\t    if (hosts.length == 0) {\n\t        console.log(tagName + ' hosts error2');\n\t        return null;\n\t    }\n\t    return hosts[0].getElementsByTagName('host');\n\n\t};\n\tconnection.prototype.getRestFromHttpDNS = function (options, type) {\n\t    if (this.restIndex > this.restTotal) {\n\t        console.log('rest hosts all tried,quit');\n\t        return;\n\t    }\n\t    var url = '';\n\t    var host = this.restHosts[this.restIndex];\n\t    var domain = _utils.getXmlFirstChild(host, 'domain');\n\t    var ip = _utils.getXmlFirstChild(host, 'ip');\n\t    if (ip) {\n\t        var port = _utils.getXmlFirstChild(host, 'port');\n\t        url = (location.protocol === 'https:' ? 'https:' : 'http:') + '//' + ip.textContent + ':' + port.textContent;\n\t    } else {\n\t        url = (location.protocol === 'https:' ? 'https:' : 'http:') + '//' + domain.textContent;\n\t    }\n\n\t    if (url != '') {\n\t        this.apiUrl = url;\n\t        options.apiUrl = url;\n\t    }\n\n\t    if (type == 'login') {\n\t        this.login(options);\n\t    } else {\n\t        this.signup(options);\n\t    }\n\t};\n\n\tconnection.prototype.getHttpDNS = function (options, type) {\n\t    if (this.restHosts) {\n\t        this.getRestFromHttpDNS(options, type);\n\t        return;\n\t    }\n\t    var self = this;\n\t    var suc = function (data, xhr) {\n\t        data = new DOMParser().parseFromString(data, \"text/xml\").documentElement;\n\t        //get rest ips\n\t        var restHosts = self.getHostsByTag(data, 'rest');\n\t        if (!restHosts) {\n\t            console.log('rest hosts error3');\n\t            return;\n\t        }\n\t        self.restHosts = restHosts;\n\t        self.restTotal = restHosts.length;\n\n\t        //get xmpp ips\n\t        var xmppHosts = self.getHostsByTag(data, 'xmpp');\n\t        if (!xmppHosts) {\n\t            console.log('xmpp hosts error3');\n\t            return;\n\t        }\n\t        self.xmppHosts = xmppHosts;\n\t        self.xmppTotal = xmppHosts.length;\n\n\t        self.getRestFromHttpDNS(options, type);\n\t    };\n\t    var error = function (res, xhr, msg) {\n\n\t        console.log('getHttpDNS error', res, msg);\n\t        self.dnsIndex++;\n\t        if (self.dnsIndex < self.dnsTotal) {\n\t            self.getHttpDNS(options, type);\n\t        }\n\n\t    };\n\t    var options2 = {\n\t        url: this.dnsArr[this.dnsIndex] + '/easemob/server.xml',\n\t        dataType: 'text',\n\t        type: 'GET',\n\n\t        // url: 'http://www.easemob.com/easemob/server.xml',\n\t        // dataType: 'xml',\n\t        data: {app_key: encodeURIComponent(options.appKey)},\n\t        success: suc || _utils.emptyfn,\n\t        error: error || _utils.emptyfn\n\t    };\n\t    _utils.ajax(options2);\n\t};\n\n\tconnection.prototype.signup = function (options) {\n\t    var self = this;\n\t    var orgName = options.orgName || '';\n\t    var appName = options.appName || '';\n\t    var appKey = options.appKey || '';\n\t    var suc = options.success || EMPTYFN;\n\t    var err = options.error || EMPTYFN;\n\n\t    if (!orgName && !appName && appKey) {\n\t        var devInfos = appKey.split('#');\n\t        if (devInfos.length === 2) {\n\t            orgName = devInfos[0];\n\t            appName = devInfos[1];\n\t        }\n\t    }\n\t    if (!orgName && !appName) {\n\t        err({\n\t            type: _code.WEBIM_CONNCTION_APPKEY_NOT_ASSIGN_ERROR\n\t        });\n\t        return;\n\t    }\n\n\t    var error = function (res, xhr, msg) {\n\t        if (location.protocol != 'https:' && self.isHttpDNS) {\n\t            if ((self.restIndex + 1) < self.restTotal) {\n\t                self.restIndex++;\n\t                self.getRestFromHttpDNS(options, 'signup');\n\t                return;\n\t            }\n\t        }\n\t        self.clear();\n\t        err(res);\n\t    };\n\t    var https = options.https || https;\n\t    var apiUrl = options.apiUrl;\n\t    var restUrl = apiUrl + '/' + orgName + '/' + appName + '/users';\n\n\t    var userjson = {\n\t        username: options.username,\n\t        password: options.password,\n\t        nickname: options.nickname || ''\n\t    };\n\n\t    var userinfo = _utils.stringify(userjson);\n\t    var options2 = {\n\t        url: restUrl,\n\t        dataType: 'json',\n\t        data: userinfo,\n\t        success: suc,\n\t        error: error\n\t    };\n\t    _utils.ajax(options2);\n\t};\n\n\n\tconnection.prototype.open = function (options) {\n\t    if (location.protocol != 'https:' && this.isHttpDNS) {\n\t        this.dnsIndex = 0;\n\t        this.getHttpDNS(options, 'login');\n\t    } else {\n\t        this.login(options);\n\t    }\n\t};\n\n\tconnection.prototype.login = function (options) {\n\t    var pass = _validCheck(options, this);\n\n\t    if (!pass) {\n\t        return;\n\t    }\n\n\t    var conn = this;\n\n\t    if (conn.isOpened()) {\n\t        return;\n\t    }\n\n\t    if (options.accessToken) {\n\t        options.access_token = options.accessToken;\n\t        _login(options, conn);\n\t    } else {\n\t        var apiUrl = options.apiUrl;\n\t        var userId = this.context.userId;\n\t        var pwd = options.pwd || '';\n\t        var appName = this.context.appName;\n\t        var orgName = this.context.orgName;\n\n\t        var suc = function (data, xhr) {\n\t            conn.context.status = _code.STATUS_DOLOGIN_IM;\n\t            conn.context.restTokenData = data;\n\t            _login(data, conn);\n\t        };\n\t        var error = function (res, xhr, msg) {\n\t            if (location.protocol != 'https:' && conn.isHttpDNS) {\n\t                if ((conn.restIndex + 1) < conn.restTotal) {\n\t                    conn.restIndex++;\n\t                    conn.getRestFromHttpDNS(options, 'login');\n\t                    return;\n\t                }\n\t            }\n\t            conn.clear();\n\t            if (res.error && res.error_description) {\n\t                conn.onError({\n\t                    type: _code.WEBIM_CONNCTION_OPEN_USERGRID_ERROR,\n\t                    data: res,\n\t                    xhr: xhr\n\t                });\n\t            } else {\n\t                conn.onError({\n\t                    type: _code.WEBIM_CONNCTION_OPEN_ERROR,\n\t                    data: res,\n\t                    xhr: xhr\n\t                });\n\t            }\n\t        };\n\n\t        this.context.status = _code.STATUS_DOLOGIN_USERGRID;\n\n\t        var loginJson = {\n\t            grant_type: 'password',\n\t            username: userId,\n\t            password: pwd,\n\t            timestamp: +new Date()\n\t        };\n\t        var loginfo = _utils.stringify(loginJson);\n\n\t        var options2 = {\n\t            url: apiUrl + '/' + orgName + '/' + appName + '/token',\n\t            dataType: 'json',\n\t            data: loginfo,\n\t            success: suc || _utils.emptyfn,\n\t            error: error || _utils.emptyfn\n\t        };\n\t        _utils.ajax(options2);\n\t    }\n\t};\n\n\t// attach to xmpp server for BOSH\n\tconnection.prototype.attach = function (options) {\n\t    var pass = _validCheck(options, this);\n\n\t    if (!pass) {\n\t        return;\n\t    }\n\n\t    options = options || {};\n\n\t    var accessToken = options.accessToken || '';\n\t    if (accessToken == '') {\n\t        this.onError({\n\t            type: _code.WEBIM_CONNCTION_TOKEN_NOT_ASSIGN_ERROR\n\t        });\n\t        return;\n\t    }\n\n\t    var sid = options.sid || '';\n\t    if (sid === '') {\n\t        this.onError({\n\t            type: _code.WEBIM_CONNCTION_SESSIONID_NOT_ASSIGN_ERROR\n\t        });\n\t        return;\n\t    }\n\n\t    var rid = options.rid || '';\n\t    if (rid === '') {\n\t        this.onError({\n\t            type: _code.WEBIM_CONNCTION_RID_NOT_ASSIGN_ERROR\n\t        });\n\t        return;\n\t    }\n\n\t    var stropheConn = this.getStrophe();\n\n\t    this.context.accessToken = accessToken;\n\t    this.context.stropheConn = stropheConn;\n\t    this.context.status = _code.STATUS_DOLOGIN_IM;\n\n\t    var conn = this;\n\t    var callback = function (status, msg) {\n\t        _loginCallback(status, msg, conn);\n\t    };\n\n\t    var jid = this.context.jid;\n\t    var wait = this.wait;\n\t    var hold = this.hold;\n\t    var wind = this.wind || 5;\n\t    stropheConn.attach(jid, sid, rid, callback, wait, hold, wind);\n\t};\n\n\tconnection.prototype.close = function (reason) {\n\t    this.stopHeartBeat();\n\n\t    var status = this.context.status;\n\t    if (status == _code.STATUS_INIT) {\n\t        return;\n\t    }\n\n\t    if (this.isClosed() || this.isClosing()) {\n\t        return;\n\t    }\n\n\t    this.context.status = _code.STATUS_CLOSING;\n\t    this.context.stropheConn.disconnect(reason);\n\t};\n\n\tconnection.prototype.addHandler = function (handler, ns, name, type, id, from, options) {\n\t    this.context.stropheConn.addHandler(handler, ns, name, type, id, from, options);\n\t};\n\n\tconnection.prototype.notifyVersion = function (suc, fail) {\n\t    var jid = _getJid({}, this);\n\t    var dom = $iq({\n\t        from: this.context.jid || ''\n\t        , to: this.domain\n\t        , type: 'result'\n\t    })\n\t        .c('query', {xmlns: 'jabber:iq:version'})\n\t        .c('name')\n\t        .t('easemob')\n\t        .up()\n\t        .c('version')\n\t        .t(_version)\n\t        .up()\n\t        .c('os')\n\t        .t('webim');\n\n\t    var suc = suc || _utils.emptyfn;\n\t    var error = fail || this.onError;\n\t    var failFn = function (ele) {\n\t        error({\n\t            type: _code.WEBIM_CONNCTION_NOTIFYVERSION_ERROR\n\t            , data: ele\n\t        });\n\t    };\n\t    this.context.stropheConn.sendIQ(dom.tree(), suc, failFn);\n\t    return;\n\t};\n\n\t// handle all types of presence message\n\tconnection.prototype.handlePresence = function (msginfo) {\n\t    if (this.isClosed()) {\n\t        return;\n\t    }\n\t    var from = msginfo.getAttribute('from') || '';\n\t    var to = msginfo.getAttribute('to') || '';\n\t    var type = msginfo.getAttribute('type') || '';\n\t    var presence_type = msginfo.getAttribute('presence_type') || '';\n\t    var fromUser = _parseNameFromJidFn(from);\n\t    var toUser = _parseNameFromJidFn(to);\n\t    var info = {\n\t        from: fromUser,\n\t        to: toUser,\n\t        fromJid: from,\n\t        toJid: to,\n\t        type: type,\n\t        chatroom: msginfo.getElementsByTagName('roomtype').length ? true : false\n\t    };\n\n\t    var showTags = msginfo.getElementsByTagName('show');\n\t    if (showTags && showTags.length > 0) {\n\t        var showTag = showTags[0];\n\t        info.show = Strophe.getText(showTag);\n\t    }\n\t    var statusTags = msginfo.getElementsByTagName('status');\n\t    if (statusTags && statusTags.length > 0) {\n\t        var statusTag = statusTags[0];\n\t        info.status = Strophe.getText(statusTag);\n\t        info.code = statusTag.getAttribute('code');\n\t    }\n\n\t    var priorityTags = msginfo.getElementsByTagName('priority');\n\t    if (priorityTags && priorityTags.length > 0) {\n\t        var priorityTag = priorityTags[0];\n\t        info.priority = Strophe.getText(priorityTag);\n\t    }\n\n\t    var error = msginfo.getElementsByTagName('error');\n\t    if (error && error.length > 0) {\n\t        var error = error[0];\n\t        info.error = {\n\t            code: error.getAttribute('code')\n\t        };\n\t    }\n\n\t    var destroy = msginfo.getElementsByTagName('destroy');\n\t    if (destroy && destroy.length > 0) {\n\t        var destroy = destroy[0];\n\t        info.destroy = true;\n\n\t        var reason = destroy.getElementsByTagName('reason');\n\t        if (reason && reason.length > 0) {\n\t            info.reason = Strophe.getText(reason[0]);\n\t        }\n\t    }\n\n\t    // <item affiliation=\"member\" jid=\"easemob-demo#chatdemoui_lwz2@easemob.com\" role=\"none\">\n\t    //     <actor nick=\"liuwz\"/>\n\t    // </item>\n\t    // one record once a time\n\t    // kick info: actor / member\n\t    var members = msginfo.getElementsByTagName('item');\n\t    if (members && members.length > 0) {\n\t        var member = members[0];\n\t        var role = member.getAttribute('role');\n\t        var jid = member.getAttribute('jid');\n\t        // dismissed by group\n\t        if (role == 'none' && jid) {\n\t            var kickedMember = _parseNameFromJidFn(jid);\n\t            var actor = member.getElementsByTagName('actor')[0];\n\t            var actorNick = actor.getAttribute('nick');\n\t            info.actor = actorNick;\n\t            info.kicked = kickedMember;\n\t        }\n\t        // Service Acknowledges Room Creation `createGroupACK`\n\t        if (role == 'moderator' && info.code == '201') {\n\t            // info.type = 'createGroupACK';\n\t            info.type = 'joinPublicGroupSuccess';\n\t        }\n\t    }\n\n\t    // from message : apply to join group\n\t    // <message from=\"easemob-demo#chatdemoui_lwz4@easemob.com/mobile\" id=\"259151681747419640\" to=\"easemob-demo#chatdemoui_liuwz@easemob.com\" xmlns=\"jabber:client\">\n\t    //     <x xmlns=\"http://jabber.org/protocol/muc#user\">\n\t    //         <apply from=\"easemob-demo#chatdemoui_lwz4@easemob.com\" to=\"easemob-demo#chatdemoui_1477733677560@conference.easemob.com\" toNick=\"lwzlwzlwz\">\n\t    //             <reason>qwe</reason>\n\t    //         </apply>\n\t    //     </x>\n\t    // </message>\n\t    var apply = msginfo.getElementsByTagName('apply');\n\t    if (apply && apply.length > 0) {\n\t        apply = apply[0];\n\t        var toNick = apply.getAttribute('toNick');\n\t        var groupJid = apply.getAttribute('to');\n\t        var userJid = apply.getAttribute('from');\n\t        var groupName = _parseNameFromJidFn(groupJid);\n\t        var userName = _parseNameFromJidFn(userJid);\n\t        info.toNick = toNick;\n\t        info.groupName = groupName;\n\t        info.type = 'joinGroupNotifications';\n\t        var reason = apply.getElementsByTagName('reason');\n\t        if (reason && reason.length > 0) {\n\t            info.reason = Strophe.getText(reason[0]);\n\t        }\n\t    }\n\n\n\t    if (info.chatroom) {\n\t        // diff the\n\t        info.presence_type = presence_type;\n\t        info.original_type = info.type;\n\t        var reflectUser = from.slice(from.lastIndexOf('/') + 1);\n\n\t        if (reflectUser === this.context.userId) {\n\t            if (info.type === '' && !info.code) {\n\t                info.type = 'joinChatRoomSuccess';\n\t            } else if (presence_type === 'unavailable' || info.type === 'unavailable') {\n\t                if (!info.status) {// logout successfully.\n\t                    info.type = 'leaveChatRoom';\n\t                } else if (info.code == 110) {// logout or dismissied by admin.\n\t                    info.type = 'leaveChatRoom';\n\t                } else if (info.error && info.error.code == 406) {// The chat room is full.\n\t                    info.type = 'reachChatRoomCapacity';\n\t                }\n\t            }\n\t        }\n\t    } else {\n\t        info.presence_type = presence_type;\n\t        info.original_type = type;\n\n\t        if (/subscribe/.test(info.type)) {\n\t            //subscribe | subscribed | unsubscribe | unsubscribed\n\t        } else if (type == \"\" && !info.status && !info.error) {\n\t            info.type = 'joinPublicGroupSuccess';\n\t        } else if (presence_type === 'unavailable' || type === 'unavailable') {// There is no roomtype when a chat room is deleted.\n\t            if (info.destroy) {// Group or Chat room Deleted.\n\t                info.type = 'deleteGroupChat';\n\t            } else if (info.code == 307 || info.code == 321) {// Dismissed by group.\n\t                info.type = 'leaveGroup';\n\t            }\n\t        }\n\t    }\n\t    this.onPresence(info, msginfo);\n\t};\n\n\tconnection.prototype.handlePing = function (e) {\n\t    if (this.isClosed()) {\n\t        return;\n\t    }\n\t    var id = e.getAttribute('id');\n\t    var from = e.getAttribute('from');\n\t    var to = e.getAttribute('to');\n\t    var dom = $iq({\n\t        from: to\n\t        , to: from\n\t        , id: id\n\t        , type: 'result'\n\t    });\n\t    this.sendCommand(dom.tree());\n\t};\n\n\tconnection.prototype.handleIq = function (iq) {\n\t    return true;\n\t};\n\n\tconnection.prototype.handleIqPrivacy = function (msginfo) {\n\t    var list = msginfo.getElementsByTagName('list');\n\t    if (list.length == 0) {\n\t        return;\n\t    }\n\t    this.getBlacklist();\n\t};\n\n\tconnection.prototype.handleIqRoster = function (e) {\n\t    var id = e.getAttribute('id');\n\t    var from = e.getAttribute('from') || '';\n\t    var name = _parseNameFromJidFn(from);\n\t    var curJid = this.context.jid;\n\t    var curUser = this.context.userId;\n\n\t    var iqresult = $iq({type: 'result', id: id, from: curJid});\n\t    this.sendCommand(iqresult.tree());\n\n\t    var msgBodies = e.getElementsByTagName('query');\n\t    if (msgBodies && msgBodies.length > 0) {\n\t        var queryTag = msgBodies[0];\n\t        var rouster = _parseFriend(queryTag, this, from);\n\t        this.onRoster(rouster);\n\t    }\n\t    return true;\n\t};\n\n\tconnection.prototype.handleMessage = function (msginfo) {\n\t    var self = this;\n\t    if (this.isClosed()) {\n\t        return;\n\t    }\n\n\t    var id = msginfo.getAttribute('id') || '';\n\n\t    // cache ack into sendQueue first , handelSendQueue will do the send thing with the speed of  5/s\n\t    this.cacheReceiptsMessage({\n\t        id: id\n\t    });\n\t    var parseMsgData = _parseResponseMessage(msginfo);\n\t    if (parseMsgData.errorMsg) {\n\t        this.handlePresence(msginfo);\n\t        return;\n\t    }\n\t    // send error\n\t    var error = msginfo.getElementsByTagName('error');\n\t    var errorCode = '';\n\t    var errorText = '';\n\t    var errorBool = false;\n\t    if (error.length > 0) {\n\t        errorBool = true;\n\t        errorCode = error[0].getAttribute('code');\n\t        var textDOM = error[0].getElementsByTagName('text');\n\t        errorText = textDOM[0].textContent || textDOM[0].text;\n\t        log('handle error', errorCode, errorText);\n\t    }\n\n\t    var msgDatas = parseMsgData.data;\n\t    for (var i in msgDatas) {\n\t        if (!msgDatas.hasOwnProperty(i)) {\n\t            continue;\n\t        }\n\t        var msg = msgDatas[i];\n\t        if (!msg.from || !msg.to) {\n\t            continue;\n\t        }\n\n\t        var from = (msg.from + '').toLowerCase();\n\t        var too = (msg.to + '').toLowerCase();\n\t        var extmsg = msg.ext || {};\n\t        var chattype = '';\n\t        var typeEl = msginfo.getElementsByTagName('roomtype');\n\t        if (typeEl.length) {\n\t            chattype = typeEl[0].getAttribute('type') || 'chat';\n\t        } else {\n\t            chattype = msginfo.getAttribute('type') || 'chat';\n\t        }\n\n\t        var msgBodies = msg.bodies;\n\t        if (!msgBodies || msgBodies.length == 0) {\n\t            continue;\n\t        }\n\t        var msgBody = msg.bodies[0];\n\t        var type = msgBody.type;\n\n\t        try {\n\t            switch (type) {\n\t                case 'txt':\n\t                    var receiveMsg = msgBody.msg;\n\t                    var emojibody = _utils.parseTextMessage(receiveMsg, WebIM.Emoji);\n\t                    if (emojibody.isemoji) {\n\t                        var msg = {\n\t                            id: id\n\t                            , type: chattype\n\t                            , from: from\n\t                            , to: too\n\t                            , delay: parseMsgData.delayTimeStamp\n\t                            , data: emojibody.body\n\t                            , ext: extmsg\n\t                        };\n\t                        !msg.delay && delete msg.delay;\n\t                        msg.error = errorBool;\n\t                        msg.errorText = errorText;\n\t                        msg.errorCode = errorCode;\n\t                        this.onEmojiMessage(msg);\n\t                    } else {\n\t                        var msg = {\n\t                            id: id\n\t                            , type: chattype\n\t                            , from: from\n\t                            , to: too\n\t                            , delay: parseMsgData.delayTimeStamp\n\t                            , data: receiveMsg\n\t                            , ext: extmsg\n\t                        };\n\t                        !msg.delay && delete msg.delay;\n\t                        msg.error = errorBool;\n\t                        msg.errorText = errorText;\n\t                        msg.errorCode = errorCode;\n\t                        this.onTextMessage(msg);\n\t                    }\n\t                    break;\n\t                case 'img':\n\t                    var rwidth = 0;\n\t                    var rheight = 0;\n\t                    if (msgBody.size) {\n\t                        rwidth = msgBody.size.width;\n\t                        rheight = msgBody.size.height;\n\t                    }\n\t                    var msg = {\n\t                        id: id\n\t                        , type: chattype\n\t                        , from: from\n\t                        , to: too\n\t                        ,\n\t                        url: (location.protocol != 'https:' && self.isHttpDNS) ? (self.apiUrl + msgBody.url.substr(msgBody.url.indexOf(\"/\", 9))) : msgBody.url\n\t                        , secret: msgBody.secret\n\t                        , filename: msgBody.filename\n\t                        , thumb: msgBody.thumb\n\t                        , thumb_secret: msgBody.thumb_secret\n\t                        , file_length: msgBody.file_length || ''\n\t                        , width: rwidth\n\t                        , height: rheight\n\t                        , filetype: msgBody.filetype || ''\n\t                        , accessToken: this.context.accessToken || ''\n\t                        , ext: extmsg\n\t                        , delay: parseMsgData.delayTimeStamp\n\t                    };\n\t                    !msg.delay && delete msg.delay;\n\t                    msg.error = errorBool;\n\t                    msg.errorText = errorText;\n\t                    msg.errorCode = errorCode;\n\t                    this.onPictureMessage(msg);\n\t                    break;\n\t                case 'audio':\n\t                    var msg = {\n\t                        id: id\n\t                        , type: chattype\n\t                        , from: from\n\t                        , to: too\n\t                        ,\n\t                        url: (location.protocol != 'https:' && self.isHttpDNS) ? (self.apiUrl + msgBody.url.substr(msgBody.url.indexOf(\"/\", 9))) : msgBody.url\n\t                        , secret: msgBody.secret\n\t                        , filename: msgBody.filename\n\t                        , length: msgBody.length || ''\n\t                        , file_length: msgBody.file_length || ''\n\t                        , filetype: msgBody.filetype || ''\n\t                        , accessToken: this.context.accessToken || ''\n\t                        , ext: extmsg\n\t                        , delay: parseMsgData.delayTimeStamp\n\t                    };\n\t                    !msg.delay && delete msg.delay;\n\t                    msg.error = errorBool;\n\t                    msg.errorText = errorText;\n\t                    msg.errorCode = errorCode;\n\t                    this.onAudioMessage(msg);\n\t                    break;\n\t                case 'file':\n\t                    var msg = {\n\t                        id: id\n\t                        , type: chattype\n\t                        , from: from\n\t                        , to: too\n\t                        ,\n\t                        url: (location.protocol != 'https:' && self.isHttpDNS) ? (self.apiUrl + msgBody.url.substr(msgBody.url.indexOf(\"/\", 9))) : msgBody.url\n\t                        , secret: msgBody.secret\n\t                        , filename: msgBody.filename\n\t                        , file_length: msgBody.file_length\n\t                        , accessToken: this.context.accessToken || ''\n\t                        , ext: extmsg\n\t                        , delay: parseMsgData.delayTimeStamp\n\t                    };\n\t                    !msg.delay && delete msg.delay;\n\t                    msg.error = errorBool;\n\t                    msg.errorText = errorText;\n\t                    msg.errorCode = errorCode;\n\t                    this.onFileMessage(msg);\n\t                    break;\n\t                case 'loc':\n\t                    var msg = {\n\t                        id: id\n\t                        , type: chattype\n\t                        , from: from\n\t                        , to: too\n\t                        , addr: msgBody.addr\n\t                        , lat: msgBody.lat\n\t                        , lng: msgBody.lng\n\t                        , ext: extmsg\n\t                        , delay: parseMsgData.delayTimeStamp\n\t                    };\n\t                    !msg.delay && delete msg.delay;\n\t                    msg.error = errorBool;\n\t                    msg.errorText = errorText;\n\t                    msg.errorCode = errorCode;\n\t                    this.onLocationMessage(msg);\n\t                    break;\n\t                case 'video':\n\t                    var msg = {\n\t                        id: id\n\t                        , type: chattype\n\t                        , from: from\n\t                        , to: too\n\t                        ,\n\t                        url: (location.protocol != 'https:' && self.isHttpDNS) ? (self.apiUrl + msgBody.url.substr(msgBody.url.indexOf(\"/\", 9))) : msgBody.url\n\t                        , secret: msgBody.secret\n\t                        , filename: msgBody.filename\n\t                        , file_length: msgBody.file_length\n\t                        , accessToken: this.context.accessToken || ''\n\t                        , ext: extmsg\n\t                        , delay: parseMsgData.delayTimeStamp\n\t                    };\n\t                    !msg.delay && delete msg.delay;\n\t                    msg.error = errorBool;\n\t                    msg.errorText = errorText;\n\t                    msg.errorCode = errorCode;\n\t                    this.onVideoMessage(msg);\n\t                    break;\n\t                case 'cmd':\n\t                    var msg = {\n\t                        id: id\n\t                        , from: from\n\t                        , to: too\n\t                        , action: msgBody.action\n\t                        , ext: extmsg\n\t                        , delay: parseMsgData.delayTimeStamp\n\t                    };\n\t                    !msg.delay && delete msg.delay;\n\t                    msg.error = errorBool;\n\t                    msg.errorText = errorText;\n\t                    msg.errorCode = errorCode;\n\t                    this.onCmdMessage(msg);\n\t                    break;\n\t            }\n\t            ;\n\t        } catch (e) {\n\t            this.onError({\n\t                type: _code.WEBIM_CONNCTION_CALLBACK_INNER_ERROR\n\t                , data: e\n\t            });\n\t        }\n\t    }\n\t};\n\n\tconnection.prototype.handleReceivedMessage = function (message) {\n\t    try {\n\t        this.onReceivedMessage(message);\n\t    } catch (e) {\n\t        this.onError({\n\t            type: _code.WEBIM_CONNCTION_CALLBACK_INNER_ERROR\n\t            , data: e\n\t        });\n\t    }\n\n\t    var rcv = message.getElementsByTagName('received'),\n\t        id,\n\t        mid;\n\n\t    if (rcv.length > 0) {\n\t        if (rcv[0].childNodes && rcv[0].childNodes.length > 0) {\n\t            id = rcv[0].childNodes[0].nodeValue;\n\t        } else {\n\t            id = rcv[0].innerHTML || rcv[0].innerText;\n\t        }\n\t        mid = rcv[0].getAttribute('mid');\n\t    }\n\n\t    if (_msgHash[id]) {\n\t        try {\n\t            _msgHash[id].msg.success instanceof Function && _msgHash[id].msg.success(id, mid);\n\t        } catch (e) {\n\t            this.onError({\n\t                type: _code.WEBIM_CONNCTION_CALLBACK_INNER_ERROR\n\t                , data: e\n\t            });\n\t        }\n\t        delete _msgHash[id];\n\t    }\n\t};\n\n\tconnection.prototype.handleInviteMessage = function (message) {\n\t    var form = null;\n\t    var invitemsg = message.getElementsByTagName('invite');\n\t    var reasonDom = message.getElementsByTagName('reason')[0];\n\t    var reasonMsg = reasonDom.textContent;\n\t    var id = message.getAttribute('id') || '';\n\t    this.sendReceiptsMessage({\n\t        id: id\n\t    });\n\n\t    if (invitemsg && invitemsg.length > 0) {\n\t        var fromJid = invitemsg[0].getAttribute('from');\n\t        form = _parseNameFromJidFn(fromJid);\n\t    }\n\t    var xmsg = message.getElementsByTagName('x');\n\t    var roomid = null;\n\t    if (xmsg && xmsg.length > 0) {\n\t        for (var i = 0; i < xmsg.length; i++) {\n\t            if ('jabber:x:conference' === xmsg[i].namespaceURI) {\n\t                var roomjid = xmsg[i].getAttribute('jid');\n\t                roomid = _parseNameFromJidFn(roomjid);\n\t            }\n\t        }\n\t    }\n\t    this.onInviteMessage({\n\t        type: 'invite',\n\t        from: form,\n\t        roomid: roomid,\n\t        reason: reasonMsg\n\t    });\n\t};\n\n\tconnection.prototype.sendCommand = function (dom, id) {\n\t    if (this.isOpened()) {\n\t        this.context.stropheConn.send(dom);\n\t    } else {\n\t        this.onError({\n\t            type: _code.WEBIM_CONNCTION_DISCONNECTED,\n\t            reconnect: true\n\t        });\n\t    }\n\t};\n\n\tconnection.prototype.getUniqueId = function (prefix) {\n\t    var cdate = new Date();\n\t    var offdate = new Date(2010, 1, 1);\n\t    var offset = cdate.getTime() - offdate.getTime();\n\t    var hexd = parseInt(offset).toString(16);\n\n\t    if (typeof prefix === 'string' || typeof prefix === 'number') {\n\t        return prefix + '_' + hexd;\n\t    } else {\n\t        return 'WEBIM_' + hexd;\n\t    }\n\t};\n\n\tconnection.prototype.send = function (message) {\n\t    var self = this;\n\t    if (this.isWindowSDK) {\n\t        WebIM.doQuery('{\"type\":\"sendMessage\",\"to\":\"' + message.to + '\",\"message_type\":\"' + message.type + '\",\"msg\":\"' + encodeURI(message.msg) + '\",\"chatType\":\"' + message.chatType + '\"}',\n\t            function (response) {\n\t            },\n\t            function (code, msg) {\n\t                var message = {\n\t                    data: {\n\t                        data: \"send\"\n\t                    },\n\t                    type: _code.WEBIM_MESSAGE_SED_ERROR\n\t                };\n\t                self.onError(message);\n\t            });\n\t    } else {\n\t        if (Object.prototype.toString.call(message) === '[object Object]') {\n\t            var appKey = this.context.appKey || '';\n\t            var toJid = appKey + '_' + message.to + '@' + this.domain;\n\n\t            if (message.group) {\n\t                toJid = appKey + '_' + message.to + '@conference.' + this.domain;\n\t            }\n\t            if (message.resource) {\n\t                toJid = toJid + '/' + message.resource;\n\t            }\n\n\t            message.toJid = toJid;\n\t            message.id = message.id || this.getUniqueId();\n\t            _msgHash[message.id] = new _message(message);\n\t            _msgHash[message.id].send(this);\n\t        } else if (typeof message === 'string') {\n\t            _msgHash[message] && _msgHash[message].send(this);\n\t        }\n\t    }\n\t};\n\n\tconnection.prototype.addRoster = function (options) {\n\t    var jid = _getJid(options, this);\n\t    var name = options.name || '';\n\t    var groups = options.groups || '';\n\n\t    var iq = $iq({type: 'set'});\n\t    iq.c('query', {xmlns: 'jabber:iq:roster'});\n\t    iq.c('item', {jid: jid, name: name});\n\n\t    if (groups) {\n\t        for (var i = 0; i < groups.length; i++) {\n\t            iq.c('group').t(groups[i]).up();\n\t        }\n\t    }\n\t    var suc = options.success || _utils.emptyfn;\n\t    var error = options.error || _utils.emptyfn;\n\t    this.context.stropheConn.sendIQ(iq.tree(), suc, error);\n\t};\n\n\tconnection.prototype.removeRoster = function (options) {\n\t    var jid = _getJid(options, this);\n\t    var iq = $iq({type: 'set'}).c('query', {xmlns: 'jabber:iq:roster'}).c('item', {\n\t        jid: jid,\n\t        subscription: 'remove'\n\t    });\n\n\t    var suc = options.success || _utils.emptyfn;\n\t    var error = options.error || _utils.emptyfn;\n\t    this.context.stropheConn.sendIQ(iq, suc, error);\n\t};\n\n\tconnection.prototype.getRoster = function (options) {\n\t    var conn = this;\n\t    var dom = $iq({\n\t        type: 'get'\n\t    }).c('query', {xmlns: 'jabber:iq:roster'});\n\n\t    var options = options || {};\n\t    var suc = options.success || this.onRoster;\n\t    var completeFn = function (ele) {\n\t        var rouster = [];\n\t        var msgBodies = ele.getElementsByTagName('query');\n\t        if (msgBodies && msgBodies.length > 0) {\n\t            var queryTag = msgBodies[0];\n\t            rouster = _parseFriend(queryTag);\n\t        }\n\t        suc(rouster, ele);\n\t    };\n\t    var error = options.error || this.onError;\n\t    var failFn = function (ele) {\n\t        error({\n\t            type: _code.WEBIM_CONNCTION_GETROSTER_ERROR\n\t            , data: ele\n\t        });\n\t    };\n\t    if (this.isOpened()) {\n\t        this.context.stropheConn.sendIQ(dom.tree(), completeFn, failFn);\n\t    } else {\n\t        error({\n\t            type: _code.WEBIM_CONNCTION_DISCONNECTED\n\t        });\n\t    }\n\t};\n\n\tconnection.prototype.subscribe = function (options) {\n\t    var jid = _getJid(options, this);\n\t    var pres = $pres({to: jid, type: 'subscribe'});\n\t    if (options.message) {\n\t        pres.c('status').t(options.message).up();\n\t    }\n\t    if (options.nick) {\n\t        pres.c('nick', {'xmlns': 'http://jabber.org/protocol/nick'}).t(options.nick);\n\t    }\n\t    this.sendCommand(pres.tree());\n\t};\n\n\tconnection.prototype.subscribed = function (options) {\n\t    var jid = _getJid(options, this);\n\t    var pres = $pres({to: jid, type: 'subscribed'});\n\n\t    if (options.message) {\n\t        pres.c('status').t(options.message).up();\n\t    }\n\t    this.sendCommand(pres.tree());\n\t};\n\n\tconnection.prototype.unsubscribe = function (options) {\n\t    var jid = _getJid(options, this);\n\t    var pres = $pres({to: jid, type: 'unsubscribe'});\n\n\t    if (options.message) {\n\t        pres.c('status').t(options.message);\n\t    }\n\t    this.sendCommand(pres.tree());\n\t};\n\n\tconnection.prototype.unsubscribed = function (options) {\n\t    var jid = _getJid(options, this);\n\t    var pres = $pres({to: jid, type: 'unsubscribed'});\n\n\t    if (options.message) {\n\t        pres.c('status').t(options.message).up();\n\t    }\n\t    this.sendCommand(pres.tree());\n\t};\n\n\n\tconnection.prototype.joinPublicGroup = function (options) {\n\t    var roomJid = this.context.appKey + '_' + options.roomId + '@conference.' + this.domain;\n\t    var room_nick = roomJid + '/' + this.context.userId;\n\t    var suc = options.success || _utils.emptyfn;\n\t    var err = options.error || _utils.emptyfn;\n\t    var errorFn = function (ele) {\n\t        err({\n\t            type: _code.WEBIM_CONNCTION_JOINROOM_ERROR,\n\t            data: ele\n\t        });\n\t    };\n\t    var iq = $pres({\n\t        from: this.context.jid,\n\t        to: room_nick\n\t    })\n\t        .c('x', {xmlns: Strophe.NS.MUC});\n\n\t    this.context.stropheConn.sendIQ(iq.tree(), suc, errorFn);\n\t};\n\n\tconnection.prototype.listRooms = function (options) {\n\t    var iq = $iq({\n\t        to: options.server || 'conference.' + this.domain,\n\t        from: this.context.jid,\n\t        type: 'get'\n\t    })\n\t        .c('query', {xmlns: Strophe.NS.DISCO_ITEMS});\n\n\t    var suc = options.success || _utils.emptyfn;\n\t    var error = options.error || this.onError;\n\t    var completeFn = function (result) {\n\t        var rooms = [];\n\t        rooms = _parseRoom(result);\n\t        try {\n\t            suc(rooms);\n\t        } catch (e) {\n\t            error({\n\t                type: _code.WEBIM_CONNCTION_GETROOM_ERROR,\n\t                data: e\n\t            });\n\t        }\n\t    };\n\t    var err = options.error || _utils.emptyfn;\n\t    var errorFn = function (ele) {\n\t        err({\n\t            type: _code.WEBIM_CONNCTION_GETROOM_ERROR\n\t            , data: ele\n\t        });\n\t    };\n\t    this.context.stropheConn.sendIQ(iq.tree(), completeFn, errorFn);\n\t};\n\n\tconnection.prototype.queryRoomMember = function (options) {\n\t    var domain = this.domain;\n\t    var members = [];\n\t    var iq = $iq({\n\t        to: this.context.appKey + '_' + options.roomId + '@conference.' + this.domain\n\t        , type: 'get'\n\t    })\n\t        .c('query', {xmlns: Strophe.NS.MUC + '#admin'})\n\t        .c('item', {affiliation: 'member'});\n\n\t    var suc = options.success || _utils.emptyfn;\n\t    var completeFn = function (result) {\n\t        var items = result.getElementsByTagName('item');\n\n\t        if (items) {\n\t            for (var i = 0; i < items.length; i++) {\n\t                var item = items[i];\n\t                var mem = {\n\t                    jid: item.getAttribute('jid')\n\t                    , affiliation: 'member'\n\t                };\n\t                members.push(mem);\n\t            }\n\t        }\n\t        suc(members);\n\t    };\n\t    var err = options.error || _utils.emptyfn;\n\t    var errorFn = function (ele) {\n\t        err({\n\t            type: _code.WEBIM_CONNCTION_GETROOMMEMBER_ERROR\n\t            , data: ele\n\t        });\n\t    };\n\t    this.context.stropheConn.sendIQ(iq.tree(), completeFn, errorFn);\n\t};\n\n\tconnection.prototype.queryRoomInfo = function (options) {\n\t    var domain = this.domain;\n\t    var iq = $iq({\n\t        to: this.context.appKey + '_' + options.roomId + '@conference.' + domain,\n\t        type: 'get'\n\t    }).c('query', {xmlns: Strophe.NS.DISCO_INFO});\n\n\t    var suc = options.success || _utils.emptyfn;\n\t    var members = [];\n\n\t    var completeFn = function (result) {\n\t        var settings = '';\n\t        var features = result.getElementsByTagName('feature');\n\t        if (features) {\n\t            settings = features[1].getAttribute('var') + '|' + features[3].getAttribute('var') + '|' + features[4].getAttribute('var');\n\t        }\n\t        switch (settings) {\n\t            case 'muc_public|muc_membersonly|muc_notallowinvites':\n\t                settings = 'PUBLIC_JOIN_APPROVAL';\n\t                break;\n\t            case 'muc_public|muc_open|muc_notallowinvites':\n\t                settings = 'PUBLIC_JOIN_OPEN';\n\t                break;\n\t            case 'muc_hidden|muc_membersonly|muc_allowinvites':\n\t                settings = 'PRIVATE_MEMBER_INVITE';\n\t                break;\n\t            case 'muc_hidden|muc_membersonly|muc_notallowinvites':\n\t                settings = 'PRIVATE_OWNER_INVITE';\n\t                break;\n\t        }\n\t        var owner = '';\n\t        var fields = result.getElementsByTagName('field');\n\t        var fieldValues = {};\n\t        if (fields) {\n\t            for (var i = 0; i < fields.length; i++) {\n\t                var field = fields[i];\n\t                var fieldVar = field.getAttribute('var');\n\t                var fieldSimplify = fieldVar.split('_')[1];\n\t                switch (fieldVar) {\n\t                    case 'muc#roominfo_occupants':\n\t                    case 'muc#roominfo_maxusers':\n\t                    case 'muc#roominfo_affiliations':\n\t                    case 'muc#roominfo_description':\n\t                        fieldValues[fieldSimplify] = (field.textContent || field.text || '');\n\t                        break;\n\t                    case 'muc#roominfo_owner':\n\t                        var mem = {\n\t                            jid: (field.textContent || field.text) + '@' + domain\n\t                            , affiliation: 'owner'\n\t                        };\n\t                        members.push(mem);\n\t                        fieldValues[fieldSimplify] = (field.textContent || field.text);\n\t                        break;\n\t                }\n\n\t                // if (field.getAttribute('label') === 'owner') {\n\t                //     var mem = {\n\t                //         jid: (field.textContent || field.text) + '@' + domain\n\t                //         , affiliation: 'owner'\n\t                //     };\n\t                //     members.push(mem);\n\t                //     break;\n\t                // }\n\t            }\n\t            fieldValues['name'] = (result.getElementsByTagName('identity')[0]).getAttribute('name');\n\t        }\n\t        log(settings, members, fieldValues);\n\t        suc(settings, members, fieldValues);\n\t    };\n\t    var err = options.error || _utils.emptyfn;\n\t    var errorFn = function (ele) {\n\t        err({\n\t            type: _code.WEBIM_CONNCTION_GETROOMINFO_ERROR\n\t            , data: ele\n\t        });\n\t    };\n\t    this.context.stropheConn.sendIQ(iq.tree(), completeFn, errorFn);\n\t};\n\n\tconnection.prototype.queryRoomOccupants = function (options) {\n\t    var suc = options.success || _utils.emptyfn;\n\t    var completeFn = function (result) {\n\t        var occupants = [];\n\t        occupants = _parseRoomOccupants(result);\n\t        suc(occupants);\n\t    }\n\t    var err = options.error || _utils.emptyfn;\n\t    var errorFn = function (ele) {\n\t        err({\n\t            type: _code.WEBIM_CONNCTION_GETROOMOCCUPANTS_ERROR\n\t            , data: ele\n\t        });\n\t    };\n\t    var attrs = {\n\t        xmlns: Strophe.NS.DISCO_ITEMS\n\t    };\n\t    var info = $iq({\n\t        from: this.context.jid\n\t        , to: this.context.appKey + '_' + options.roomId + '@conference.' + this.domain\n\t        , type: 'get'\n\t    }).c('query', attrs);\n\t    this.context.stropheConn.sendIQ(info.tree(), completeFn, errorFn);\n\t};\n\n\tconnection.prototype.setUserSig = function (desc) {\n\t    var dom = $pres({xmlns: 'jabber:client'});\n\t    desc = desc || '';\n\t    dom.c('status').t(desc);\n\t    this.sendCommand(dom.tree());\n\t};\n\n\tconnection.prototype.setPresence = function (type, status) {\n\t    var dom = $pres({xmlns: 'jabber:client'});\n\t    if (type) {\n\t        if (status) {\n\t            dom.c('show').t(type);\n\t            dom.up().c('status').t(status);\n\t        } else {\n\t            dom.c('show').t(type);\n\t        }\n\t    }\n\t    this.sendCommand(dom.tree());\n\t};\n\n\tconnection.prototype.getPresence = function () {\n\t    var dom = $pres({xmlns: 'jabber:client'});\n\t    var conn = this;\n\t    this.sendCommand(dom.tree());\n\t};\n\n\tconnection.prototype.ping = function (options) {\n\t    var options = options || {};\n\t    var jid = _getJid(options, this);\n\n\t    var dom = $iq({\n\t        from: this.context.jid || ''\n\t        , to: jid\n\t        , type: 'get'\n\t    }).c('ping', {xmlns: 'urn:xmpp:ping'});\n\n\t    var suc = options.success || _utils.emptyfn;\n\t    var error = options.error || this.onError;\n\t    var failFn = function (ele) {\n\t        error({\n\t            type: _code.WEBIM_CONNCTION_PING_ERROR\n\t            , data: ele\n\t        });\n\t    };\n\t    if (this.isOpened()) {\n\t        this.context.stropheConn.sendIQ(dom.tree(), suc, failFn);\n\t    } else {\n\t        error({\n\t            type: _code.WEBIM_CONNCTION_DISCONNECTED\n\t        });\n\t    }\n\t    return;\n\t};\n\n\tconnection.prototype.isOpened = function () {\n\t    return this.context.status == _code.STATUS_OPENED;\n\t};\n\n\tconnection.prototype.isOpening = function () {\n\t    var status = this.context.status;\n\t    return status == _code.STATUS_DOLOGIN_USERGRID || status == _code.STATUS_DOLOGIN_IM;\n\t};\n\n\tconnection.prototype.isClosing = function () {\n\t    return this.context.status == _code.STATUS_CLOSING;\n\t};\n\n\tconnection.prototype.isClosed = function () {\n\t    return this.context.status == _code.STATUS_CLOSED;\n\t};\n\n\tconnection.prototype.clear = function () {\n\t    var key = this.context.appKey;\n\t    if (this.errorType != _code.WEBIM_CONNCTION_DISCONNECTED) {\n\t        this.context = {\n\t            status: _code.STATUS_INIT,\n\t            appKey: key\n\t        };\n\t    }\n\t    if (this.intervalId) {\n\t        clearInterval(this.intervalId);\n\t    }\n\t    this.restIndex = 0;\n\t    this.xmppIndex = 0;\n\n\n\t    if (this.errorType == _code.WEBIM_CONNCTION_CLIENT_LOGOUT || this.errorType == -1) {\n\t        var message = {\n\t            data: {\n\t                data: \"clear\"\n\t            },\n\t            type: _code.WEBIM_CONNCTION_CLIENT_LOGOUT\n\t        };\n\t        this.onError(message);\n\t    }\n\t};\n\n\tconnection.prototype.getChatRooms = function (options) {\n\n\t    if (!_utils.isCanSetRequestHeader) {\n\t        conn.onError({\n\t            type: _code.WEBIM_CONNCTION_NOT_SUPPORT_CHATROOM_ERROR\n\t        });\n\t        return;\n\t    }\n\n\t    var conn = this,\n\t        token = options.accessToken || this.context.accessToken;\n\n\t    if (token) {\n\t        var apiUrl = options.apiUrl;\n\t        var appName = this.context.appName;\n\t        var orgName = this.context.orgName;\n\n\t        if (!appName || !orgName) {\n\t            conn.onError({\n\t                type: _code.WEBIM_CONNCTION_AUTH_ERROR\n\t            });\n\t            return;\n\t        }\n\n\t        var suc = function (data, xhr) {\n\t            typeof options.success === 'function' && options.success(data);\n\t        };\n\n\t        var error = function (res, xhr, msg) {\n\t            if (res.error && res.error_description) {\n\t                conn.onError({\n\t                    type: _code.WEBIM_CONNCTION_LOAD_CHATROOM_ERROR,\n\t                    msg: res.error_description,\n\t                    data: res,\n\t                    xhr: xhr\n\t                });\n\t            }\n\t        };\n\n\t        var pageInfo = {\n\t            pagenum: parseInt(options.pagenum) || 1,\n\t            pagesize: parseInt(options.pagesize) || 20\n\t        };\n\n\t        var opts = {\n\t            url: apiUrl + '/' + orgName + '/' + appName + '/chatrooms',\n\t            dataType: 'json',\n\t            type: 'GET',\n\t            headers: {'Authorization': 'Bearer ' + token},\n\t            data: pageInfo,\n\t            success: suc || _utils.emptyfn,\n\t            error: error || _utils.emptyfn\n\t        };\n\t        _utils.ajax(opts);\n\t    } else {\n\t        conn.onError({\n\t            type: _code.WEBIM_CONNCTION_TOKEN_NOT_ASSIGN_ERROR\n\t        });\n\t    }\n\n\t};\n\n\tconnection.prototype.joinChatRoom = function (options) {\n\t    var roomJid = this.context.appKey + '_' + options.roomId + '@conference.' + this.domain;\n\t    var room_nick = roomJid + '/' + this.context.userId;\n\t    var suc = options.success || _utils.emptyfn;\n\t    var err = options.error || _utils.emptyfn;\n\t    var errorFn = function (ele) {\n\t        err({\n\t            type: _code.WEBIM_CONNCTION_JOINCHATROOM_ERROR\n\t            , data: ele\n\t        });\n\t    };\n\n\t    var iq = $pres({\n\t        from: this.context.jid,\n\t        to: room_nick\n\t    })\n\t        .c('x', {xmlns: Strophe.NS.MUC + '#user'})\n\t        .c('item', {affiliation: 'member', role: 'participant'})\n\t        .up().up()\n\t        .c('roomtype', {xmlns: 'easemob:x:roomtype', type: 'chatroom'});\n\n\t    this.context.stropheConn.sendIQ(iq.tree(), suc, errorFn);\n\t};\n\n\tconnection.prototype.quitChatRoom = function (options) {\n\t    var roomJid = this.context.appKey + '_' + options.roomId + '@conference.' + this.domain;\n\t    var room_nick = roomJid + '/' + this.context.userId;\n\t    var suc = options.success || _utils.emptyfn;\n\t    var err = options.error || _utils.emptyfn;\n\t    var errorFn = function (ele) {\n\t        err({\n\t            type: _code.WEBIM_CONNCTION_QUITCHATROOM_ERROR\n\t            , data: ele\n\t        });\n\t    };\n\t    var iq = $pres({\n\t        from: this.context.jid,\n\t        to: room_nick,\n\t        type: 'unavailable'\n\t    })\n\t        .c('x', {xmlns: Strophe.NS.MUC + '#user'})\n\t        .c('item', {affiliation: 'none', role: 'none'})\n\t        .up().up()\n\t        .c('roomtype', {xmlns: 'easemob:x:roomtype', type: 'chatroom'});\n\n\t    this.context.stropheConn.sendIQ(iq.tree(), suc, errorFn);\n\t};\n\n\tconnection.prototype._onReceiveInviteFromGroup = function (info) {\n\t    info = eval('(' + info + ')');\n\t    var self = this;\n\t    var options = {\n\t        title: \"Group invitation\",\n\t        msg: info.user + \" invites you to join into group:\" + info.group_id,\n\t        agree: function agree() {\n\t            WebIM.doQuery('{\"type\":\"acceptInvitationFromGroup\",\"id\":\"' + info.group_id + '\",\"user\":\"' + info.user + '\"}', function (response) {\n\t            }, function (code, msg) {\n\t                var message = {\n\t                    data: {\n\t                        data: \"acceptInvitationFromGroup error:\" + msg\n\t                    },\n\t                    type: _code.WEBIM_CONNECTION_ACCEPT_INVITATION_FROM_GROUP\n\t                };\n\t                self.onError(message);\n\t            });\n\t        },\n\t        reject: function reject() {\n\t            WebIM.doQuery('{\"type\":\"declineInvitationFromGroup\",\"id\":\"' + info.group_id + '\",\"user\":\"' + info.user + '\"}', function (response) {\n\t            }, function (code, msg) {\n\t                var message = {\n\t                    data: {\n\t                        data: \"declineInvitationFromGroup error:\" + msg\n\t                    },\n\t                    type: _code.WEBIM_CONNECTION_DECLINE_INVITATION_FROM_GROUP\n\t                };\n\t                self.onError(message);\n\t            });\n\t        }\n\t    };\n\n\t    this.onConfirmPop(options);\n\t};\n\tconnection.prototype._onReceiveInviteAcceptionFromGroup = function (info) {\n\t    info = eval('(' + info + ')');\n\t    var options = {\n\t        title: \"Group invitation response\",\n\t        msg: info.user + \" agreed to join into group:\" + info.group_id,\n\t        agree: function agree() {\n\t        }\n\t    };\n\t    this.onConfirmPop(options);\n\t};\n\tconnection.prototype._onReceiveInviteDeclineFromGroup = function (info) {\n\t    info = eval('(' + info + ')');\n\t    var options = {\n\t        title: \"Group invitation response\",\n\t        msg: info.user + \" rejected to join into group:\" + info.group_id,\n\t        agree: function agree() {\n\t        }\n\t    };\n\t    this.onConfirmPop(options);\n\t};\n\tconnection.prototype._onAutoAcceptInvitationFromGroup = function (info) {\n\t    info = eval('(' + info + ')');\n\t    var options = {\n\t        title: \"Group invitation\",\n\t        msg: \"You had joined into the group:\" + info.group_name + \" automatically.Inviter:\" + info.user,\n\t        agree: function agree() {\n\t        }\n\t    };\n\t    this.onConfirmPop(options);\n\t};\n\tconnection.prototype._onLeaveGroup = function (info) {\n\t    info = eval('(' + info + ')');\n\t    var options = {\n\t        title: \"Group notification\",\n\t        msg: \"You have been out of the group:\" + info.group_id + \".Reason:\" + info.msg,\n\t        agree: function agree() {\n\t        }\n\t    };\n\t    this.onConfirmPop(options);\n\t};\n\tconnection.prototype._onReceiveJoinGroupApplication = function (info) {\n\t    info = eval('(' + info + ')');\n\t    var self = this;\n\t    var options = {\n\t        title: \"Group join application\",\n\t        msg: info.user + \" applys to join into group:\" + info.group_id,\n\t        agree: function agree() {\n\t            WebIM.doQuery('{\"type\":\"acceptJoinGroupApplication\",\"id\":\"' + info.group_id + '\",\"user\":\"' + info.user + '\"}', function (response) {\n\t            }, function (code, msg) {\n\t                var message = {\n\t                    data: {\n\t                        data: \"acceptJoinGroupApplication error:\" + msg\n\t                    },\n\t                    type: _code.WEBIM_CONNECTION_ACCEPT_JOIN_GROUP\n\t                };\n\t                self.onError(message);\n\t            });\n\t        },\n\t        reject: function reject() {\n\t            WebIM.doQuery('{\"type\":\"declineJoinGroupApplication\",\"id\":\"' + info.group_id + '\",\"user\":\"' + info.user + '\"}', function (response) {\n\t            }, function (code, msg) {\n\t                var message = {\n\t                    data: {\n\t                        data: \"declineJoinGroupApplication error:\" + msg\n\t                    },\n\t                    type: _code.WEBIM_CONNECTION_DECLINE_JOIN_GROUP\n\t                };\n\t                self.onError(message);\n\t            });\n\t        }\n\t    };\n\t    this.onConfirmPop(options);\n\t};\n\tconnection.prototype._onReceiveAcceptionFromGroup = function (info) {\n\t    info = eval('(' + info + ')');\n\t    var options = {\n\t        title: \"Group notification\",\n\t        msg: \"You had joined into the group:\" + info.group_name + \".\",\n\t        agree: function agree() {\n\t        }\n\t    };\n\t    this.onConfirmPop(options);\n\t};\n\tconnection.prototype._onReceiveRejectionFromGroup = function () {\n\t    info = eval('(' + info + ')');\n\t    var options = {\n\t        title: \"Group notification\",\n\t        msg: \"You have been rejected to join into the group:\" + info.group_name + \".\",\n\t        agree: function agree() {\n\t        }\n\t    };\n\t    this.onConfirmPop(options);\n\t};\n\tconnection.prototype._onUpdateMyGroupList = function (options) {\n\t    this.onUpdateMyGroupList(options);\n\t};\n\tconnection.prototype._onUpdateMyRoster = function (options) {\n\t    this.onUpdateMyRoster(options);\n\t};\n\tconnection.prototype.reconnect = function () {\n\t    var that = this;\n\t    setTimeout(function () {\n\t        _login(that.context.restTokenData, that);\n\t    }, (this.autoReconnectNumTotal == 0 ? 0 : this.autoReconnectInterval) * 1000);\n\t    this.autoReconnectNumTotal++;\n\t};\n\n\tconnection.prototype.closed = function () {\n\t    var message = {\n\t        data: {\n\t            data: \"Closed error\"\n\t        },\n\t        type: _code.WEBIM_CONNECTION_CLOSED\n\t    };\n\t    this.onError(message);\n\t};\n\n\t// used for blacklist\n\tfunction _parsePrivacy(iq) {\n\t    var list = [];\n\t    var items = iq.getElementsByTagName('item');\n\n\t    if (items) {\n\t        for (var i = 0; i < items.length; i++) {\n\t            var item = items[i];\n\t            var jid = item.getAttribute('value');\n\t            var order = item.getAttribute('order');\n\t            var type = item.getAttribute('type');\n\t            if (!jid) {\n\t                continue;\n\t            }\n\t            var n = _parseNameFromJidFn(jid);\n\t            list[n] = {\n\t                type: type,\n\t                order: order,\n\t                jid: jid,\n\t                name: n\n\t            };\n\t        }\n\t    }\n\t    return list;\n\t};\n\n\t// used for blacklist\n\tconnection.prototype.getBlacklist = function (options) {\n\t    options = (options || {});\n\t    var iq = $iq({type: 'get'});\n\t    var sucFn = options.success || _utils.emptyfn;\n\t    var errFn = options.error || _utils.emptyfn;\n\t    var me = this;\n\n\t    iq.c('query', {xmlns: 'jabber:iq:privacy'})\n\t        .c('list', {name: 'special'});\n\n\t    this.context.stropheConn.sendIQ(iq.tree(), function (iq) {\n\t        me.onBlacklistUpdate(_parsePrivacy(iq));\n\t        sucFn();\n\t    }, function () {\n\t        me.onBlacklistUpdate([]);\n\t        errFn();\n\t    });\n\t};\n\n\t// used for blacklist\n\tconnection.prototype.addToBlackList = function (options) {\n\t    var iq = $iq({type: 'set'});\n\t    var blacklist = options.list || {};\n\t    var type = options.type || 'jid';\n\t    var sucFn = options.success || _utils.emptyfn;\n\t    var errFn = options.error || _utils.emptyfn;\n\t    var piece = iq.c('query', {xmlns: 'jabber:iq:privacy'})\n\t        .c('list', {name: 'special'});\n\n\t    var keys = Object.keys(blacklist);\n\t    var len = keys.length;\n\t    var order = 2;\n\n\t    for (var i = 0; i < len; i++) {\n\t        var item = blacklist[keys[i]];\n\t        var type = item.type || 'jid';\n\t        var jid = item.jid;\n\n\t        piece = piece.c('item', {action: 'deny', order: order++, type: type, value: jid})\n\t            .c('message');\n\t        if (i !== len - 1) {\n\t            piece = piece.up().up();\n\t        }\n\t    }\n\n\t    // log('addToBlackList', blacklist, piece.tree());\n\t    this.context.stropheConn.sendIQ(piece.tree(), sucFn, errFn);\n\t};\n\n\t// used for blacklist\n\tconnection.prototype.removeFromBlackList = function (options) {\n\n\t    var iq = $iq({type: 'set'});\n\t    var blacklist = options.list || {};\n\t    var sucFn = options.success || _utils.emptyfn;\n\t    var errFn = options.error || _utils.emptyfn;\n\t    var piece = iq.c('query', {xmlns: 'jabber:iq:privacy'})\n\t        .c('list', {name: 'special'});\n\n\t    var keys = Object.keys(blacklist);\n\t    var len = keys.length;\n\n\t    for (var i = 0; i < len; i++) {\n\t        var item = blacklist[keys[i]];\n\t        var type = item.type || 'jid';\n\t        var jid = item.jid;\n\t        var order = item.order;\n\n\t        piece = piece.c('item', {action: 'deny', order: order, type: type, value: jid})\n\t            .c('message');\n\t        if (i !== len - 1) {\n\t            piece = piece.up().up();\n\t        }\n\t    }\n\n\t    // log('removeFromBlackList', blacklist, piece.tree());\n\t    this.context.stropheConn.sendIQ(piece.tree(), sucFn, errFn);\n\t};\n\n\tconnection.prototype._getGroupJid = function (to) {\n\t    var appKey = this.context.appKey || '';\n\t    return appKey + '_' + to + '@conference.' + this.domain;\n\t};\n\n\t// used for blacklist\n\tconnection.prototype.addToGroupBlackList = function (options) {\n\t    var sucFn = options.success || _utils.emptyfn;\n\t    var errFn = options.error || _utils.emptyfn;\n\t    var jid = _getJid(options, this);\n\t    var affiliation = 'admin';//options.affiliation || 'admin';\n\t    var to = this._getGroupJid(options.roomId);\n\t    var iq = $iq({type: 'set', to: to});\n\n\t    iq.c('query', {xmlns: 'http://jabber.org/protocol/muc#' + affiliation})\n\t        .c('item', {\n\t            affiliation: 'outcast',\n\t            jid: jid\n\t        });\n\n\t    this.context.stropheConn.sendIQ(iq.tree(), sucFn, errFn);\n\t};\n\n\tfunction _parseGroupBlacklist(iq) {\n\t    var list = {};\n\t    var items = iq.getElementsByTagName('item');\n\n\t    if (items) {\n\t        for (var i = 0; i < items.length; i++) {\n\t            var item = items[i];\n\t            var jid = item.getAttribute('jid');\n\t            var affiliation = item.getAttribute('affiliation');\n\t            var nick = item.getAttribute('nick');\n\t            if (!jid) {\n\t                continue;\n\t            }\n\t            var n = _parseNameFromJidFn(jid);\n\t            list[n] = {\n\t                jid: jid,\n\t                affiliation: affiliation,\n\t                nick: nick,\n\t                name: n\n\t            };\n\t        }\n\t    }\n\t    return list;\n\t}\n\n\t// used for blacklist\n\tconnection.prototype.getGroupBlacklist = function (options) {\n\t    var sucFn = options.success || _utils.emptyfn;\n\t    var errFn = options.error || _utils.emptyfn;\n\n\t    // var jid = _getJid(options, this);\n\t    var affiliation = 'admin';//options.affiliation || 'admin';\n\t    var to = this._getGroupJid(options.roomId);\n\t    var iq = $iq({type: 'get', to: to});\n\n\t    iq.c('query', {xmlns: 'http://jabber.org/protocol/muc#' + affiliation})\n\t        .c('item', {\n\t            affiliation: 'outcast',\n\t        });\n\n\t    this.context.stropheConn.sendIQ(iq.tree(), function (msginfo) {\n\t        log('getGroupBlackList');\n\t        sucFn(_parseGroupBlacklist(msginfo));\n\t    }, function () {\n\t        errFn();\n\t    });\n\t};\n\n\t// used for blacklist\n\tconnection.prototype.removeGroupMemberFromBlacklist = function (options) {\n\t    var sucFn = options.success || _utils.emptyfn;\n\t    var errFn = options.error || _utils.emptyfn;\n\n\t    var jid = _getJid(options, this);\n\t    var affiliation = 'admin';//options.affiliation || 'admin';\n\t    var to = this._getGroupJid(options.roomId);\n\t    var iq = $iq({type: 'set', to: to});\n\n\t    iq.c('query', {xmlns: 'http://jabber.org/protocol/muc#' + affiliation})\n\t        .c('item', {\n\t            affiliation: 'member',\n\t            jid: jid\n\t        });\n\n\t    this.context.stropheConn.sendIQ(iq.tree(), function (msginfo) {\n\t        sucFn();\n\t    }, function () {\n\t        errFn();\n\t    });\n\t};\n\n\t/**\n\t * changeGroupSubject 修改群名称\n\t *\n\t * @param options\n\t */\n\t// <iq to='easemob-demo#chatdemoui_roomid@conference.easemob.com' type='set' id='3940489311' xmlns='jabber:client'>\n\t//     <query xmlns='http://jabber.org/protocol/muc#owner'>\n\t//         <x type='submit' xmlns='jabber:x:data'>\n\t//             <field var='FORM_TYPE'><value>http://jabber.org/protocol/muc#roomconfig</value></field>\n\t//             <field var='muc#roomconfig_roomname'><value>Room Name</value></field>\n\t//         </x>\n\t//     </query>\n\t// </iq>\n\tconnection.prototype.changeGroupSubject = function (options) {\n\t    var sucFn = options.success || _utils.emptyfn;\n\t    var errFn = options.error || _utils.emptyfn;\n\n\t    // must be `owner`\n\t    var affiliation = 'owner';\n\t    var to = this._getGroupJid(options.roomId);\n\t    var iq = $iq({type: 'set', to: to});\n\n\t    iq.c('query', {xmlns: 'http://jabber.org/protocol/muc#' + affiliation})\n\t        .c('x', {type: 'submit', xmlns: 'jabber:x:data'})\n\t        .c('field', {'var': 'FORM_TYPE'})\n\t        .c('value')\n\t        .t('http://jabber.org/protocol/muc#roomconfig')\n\t        .up().up()\n\t        .c('field', {'var': 'muc#roomconfig_roomname'})\n\t        .c('value')\n\t        .t(options.subject)\n\t        .up().up()\n\t        .c('field', {'var': 'muc#roomconfig_roomdesc'})\n\t        .c('value')\n\t        .t(options.description);\n\n\n\t    this.context.stropheConn.sendIQ(iq.tree(), function (msginfo) {\n\t        sucFn();\n\t    }, function () {\n\t        errFn();\n\t    });\n\t};\n\n\t/**\n\t * destroyGroup 删除群组\n\t *\n\t * @param options\n\t */\n\t// <iq id=\"9BEF5D20-841A-4048-B33A-F3F871120E58\" to=\"easemob-demo#chatdemoui_1477462231499@conference.easemob.com\" type=\"set\">\n\t//     <query xmlns=\"http://jabber.org/protocol/muc#owner\">\n\t//         <destroy>\n\t//             <reason>xxx destory group yyy</reason>\n\t//         </destroy>\n\t//     </query>\n\t// </iq>\n\tconnection.prototype.destroyGroup = function (options) {\n\t    var sucFn = options.success || _utils.emptyfn;\n\t    var errFn = options.error || _utils.emptyfn;\n\n\t    // must be `owner`\n\t    var affiliation = 'owner';\n\t    var to = this._getGroupJid(options.roomId);\n\t    var iq = $iq({type: 'set', to: to});\n\n\t    iq.c('query', {xmlns: 'http://jabber.org/protocol/muc#' + affiliation})\n\t        .c('destroy')\n\t        .c('reason').t(options.reason || '');\n\n\t    this.context.stropheConn.sendIQ(iq.tree(), function (msginfo) {\n\t        sucFn();\n\t    }, function () {\n\t        errFn();\n\t    });\n\t};\n\n\t/**\n\t * leaveGroupBySelf 主动离开群组\n\t *\n\t * @param options\n\t */\n\t// <iq id=\"5CD33172-7B62-41B7-98BC-CE6EF840C4F6_easemob_occupants_change_affiliation\" to=\"easemob-demo#chatdemoui_1477481609392@conference.easemob.com\" type=\"set\">\n\t//     <query xmlns=\"http://jabber.org/protocol/muc#admin\">\n\t//         <item affiliation=\"none\" jid=\"easemob-demo#chatdemoui_lwz2@easemob.com\"/>\n\t//     </query>\n\t// </iq>\n\tconnection.prototype.leaveGroupBySelf = function (options) {\n\t    var sucFn = options.success || _utils.emptyfn;\n\t    var errFn = options.error || _utils.emptyfn;\n\n\t    // must be `owner`\n\t    var jid = _getJid(options, this);\n\t    var affiliation = 'admin';\n\t    var to = this._getGroupJid(options.roomId);\n\t    var iq = $iq({type: 'set', to: to});\n\n\t    iq.c('query', {xmlns: 'http://jabber.org/protocol/muc#' + affiliation})\n\t        .c('item', {\n\t            affiliation: 'none',\n\t            jid: jid\n\t        });\n\n\t    this.context.stropheConn.sendIQ(iq.tree(), function (msgInfo) {\n\t        sucFn(msgInfo);\n\t    }, function (errInfo) {\n\t        errFn(errInfo);\n\t    });\n\t};\n\n\t/**\n\t * leaveGroup 被踢出群组\n\t *\n\t * @param options\n\t */\n\t// <iq id=\"9fb25cf4-1183-43c9-961e-9df70e300de4:sendIQ\" to=\"easemob-demo#chatdemoui_1477481597120@conference.easemob.com\" type=\"set\" xmlns=\"jabber:client\">\n\t//     <query xmlns=\"http://jabber.org/protocol/muc#admin\">\n\t//         <item affiliation=\"none\" jid=\"easemob-demo#chatdemoui_lwz4@easemob.com\"/>\n\t//         <item jid=\"easemob-demo#chatdemoui_lwz4@easemob.com\" role=\"none\"/>\n\t//         <item affiliation=\"none\" jid=\"easemob-demo#chatdemoui_lwz2@easemob.com\"/>\n\t//         <item jid=\"easemob-demo#chatdemoui_lwz2@easemob.com\" role=\"none\"/>\n\t//     </query>\n\t// </iq>\n\tconnection.prototype.leaveGroup = function (options) {\n\t    var sucFn = options.success || _utils.emptyfn;\n\t    var errFn = options.error || _utils.emptyfn;\n\t    var list = options.list || [];\n\t    var affiliation = 'admin';\n\t    var to = this._getGroupJid(options.roomId);\n\t    var iq = $iq({type: 'set', to: to});\n\t    var piece = iq.c('query', {xmlns: 'http://jabber.org/protocol/muc#' + affiliation});\n\t    var keys = Object.keys(list);\n\t    var len = keys.length;\n\n\t    for (var i = 0; i < len; i++) {\n\t        var name = list[keys[i]];\n\t        var jid = _getJidByName(name, this);\n\n\t        piece = piece.c('item', {\n\t            affiliation: 'none',\n\t            jid: jid\n\t        }).up().c('item', {\n\t            role: 'none',\n\t            jid: jid,\n\t        }).up();\n\t    }\n\n\t    this.context.stropheConn.sendIQ(iq.tree(), function (msgInfo) {\n\t        sucFn(msgInfo);\n\t    }, function (errInfo) {\n\t        errFn(errInfo);\n\t    });\n\t};\n\n\t/**\n\t * addGroupMembers 添加群组成员\n\t *\n\t * @param options\n\n\t Attention the sequence: message first (每个成员单独发一条message), iq second (多个成员可以合成一条iq发)\n\t <!-- 添加成员通知：send -->\n\t <message to='easemob-demo#chatdemoui_1477482739698@conference.easemob.com'>\n\t <x xmlns='http://jabber.org/protocol/muc#user'>\n\t <invite to='easemob-demo#chatdemoui_lwz2@easemob.com'>\n\t <reason>liuwz invite you to join group '谢谢'</reason>\n\t </invite>\n\t </x>\n\t </message>\n\t <!-- 添加成员：send -->\n\t <iq id='09DFB1E5-C939-4C43-B5A7-8000DA0E3B73_easemob_occupants_change_affiliation' to='easemob-demo#chatdemoui_1477482739698@conference.easemob.com' type='set'>\n\t <query xmlns='http://jabber.org/protocol/muc#admin'>\n\t <item affiliation='member' jid='easemob-demo#chatdemoui_lwz2@easemob.com'/>\n\t </query>\n\t </iq>\n\t */\n\n\tconnection.prototype.addGroupMembers = function (options) {\n\t    var sucFn = options.success || _utils.emptyfn;\n\t    var errFn = options.error || _utils.emptyfn;\n\t    var list = options.list || [];\n\t    var affiliation = 'admin';\n\t    var to = this._getGroupJid(options.roomId);\n\t    var iq = $iq({type: 'set', to: to});\n\t    var piece = iq.c('query', {xmlns: 'http://jabber.org/protocol/muc#' + affiliation});\n\t    var len = list.length;\n\n\t    for (var i = 0; i < len; i++) {\n\n\t        var name = list[i];\n\t        var jid = _getJidByName(name, this);\n\n\t        piece = piece.c('item', {\n\t            affiliation: 'member',\n\t            jid: jid\n\t        }).up();\n\n\t        var dom = $msg({\n\t            to: to\n\t        }).c('x', {\n\t            xmlns: 'http://jabber.org/protocol/muc#user'\n\t        }).c('invite', {\n\t            to: jid\n\t        }).c('reason').t(options.reason || '');\n\n\t        this.sendCommand(dom.tree());\n\n\t    }\n\n\t    this.context.stropheConn.sendIQ(iq.tree(), function (msgInfo) {\n\t        sucFn(msgInfo);\n\t    }, function (errInfo) {\n\t        errFn(errInfo);\n\t    });\n\t};\n\n\t/**\n\t * acceptInviteFromGroup 接受加入申请\n\t *\n\t * @param options\n\t */\n\tconnection.prototype.acceptInviteFromGroup = function (options) {\n\t    options.success = function () {\n\t        // then send sendAcceptInviteMessage\n\t        // connection.prototype.sendAcceptInviteMessage(optoins);\n\t    };\n\t    this.addGroupMembers(options);\n\t};\n\n\t/**\n\t * rejectInviteFromGroup 拒绝入群申请\n\t *\n\t * throw request for now 暂时不处理，直接丢弃\n\t *\n\t <message to='easemob-demo#chatdemoui_mt002@easemob.com' from='easmeob-demo#chatdemoui_mt001@easemob.com' id='B83B7210-BCFF-4DEE-AB28-B9FE5579C1E2'>\n\t <x xmlns='http://jabber.org/protocol/muc#user'>\n\t <apply to='easemob-demo#chatdemoui_groupid1@conference.easemob.com' from='easmeob-demo#chatdemoui_mt001@easemob.com' toNick='llllll'>\n\t <reason>reject</reason>\n\t </apply>\n\t </x>\n\t </message>\n\t *\n\t * @param options\n\t */\n\tconnection.prototype.rejectInviteFromGroup = function (options) {\n\t    // var from = _getJidByName(options.from, this);\n\t    // var dom = $msg({\n\t    //     from: from,\n\t    //     to: _getJidByName(options.to, this)\n\t    // }).c('x', {\n\t    //     xmlns: 'http://jabber.org/protocol/muc#user'\n\t    // }).c('apply', {\n\t    //     from: from,\n\t    //     to: this._getGroupJid(options.groupId),\n\t    //     toNick: options.groupName\n\t    // }).c('reason').t(options.reason || '');\n\t    //\n\t    // this.sendCommand(dom.tree());\n\t};\n\n\t/**\n\t * createGroup 创建群组\n\t *\n\t * 1. 创建申请 -> 得到房主身份\n\t * 2. 获取房主信息 -> 得到房间form\n\t * 3. 完善房间form -> 创建成功\n\t * 4. 添加房间成员\n\t * 5. 消息通知成员\n\t * @param options\n\t */\n\tconnection.prototype.createGroup = function (options) {\n\t    var roomId = +new Date();\n\t    var toRoom = this._getGroupJid(roomId);\n\t    var to = toRoom + '/' + this.context.userId;\n\n\t    var pres = $pres({to: to})\n\t        .c('x', {xmlns: 'http://jabber.org/protocol/muc'}).up()\n\t        .c('create', {xmlns: 'http://jabber.org/protocol/muc'}).up();\n\t    // .c('c', {\n\t    //     hash: 'sha-1',\n\t    //     node: 'https://github.com/robbiehanson/XMPPFramework',\n\t    //     ver: 'k6gP4Ua5m4uu9YorAG0LRXM+kZY=',\n\t    //     xmlns: 'http://jabber.org/protocol/caps'\n\t    // }).up();\n\n\t    // createGroupACK\n\t    this.sendCommand(pres.tree());\n\n\t    var me = this;\n\t    // timeout hack for create group async\n\t    setTimeout(function () {\n\t        // Creating a Reserved Room\n\t        var iq = $iq({type: 'get', to: toRoom})\n\t            .c('query', {xmlns: 'http://jabber.org/protocol/muc#owner'});\n\n\t        // Strophe.info('step 1 ----------');\n\t        // Strophe.info(options);\n\t        me.context.stropheConn.sendIQ(iq.tree(), function (msgInfo) {\n\t            // log(msgInfo);\n\n\t            // for ie hack\n\t            if ('setAttribute' in msgInfo) {\n\t                // Strophe.info('step 3 ----------');\n\t                var x = msgInfo.getElementsByTagName('x')[0];\n\t                x.setAttribute('type', 'submit');\n\t            } else {\n\t                // Strophe.info('step 4 ----------');\n\t                Strophe.forEachChild(msgInfo, 'x', function (field) {\n\t                    field.setAttribute('type', 'submit');\n\t                });\n\t            }\n\n\t            // var rcv = msgInfo.getElementsByTagName('x');\n\t            // var v;\n\t            // if (rcv.length > 0) {\n\t            //     if (rcv[0].childNodes && rcv[0].childNodes.length > 0) {\n\t            //         v = rcv[0].childNodes[0].nodeValue;\n\t            //     } else {\n\t            //         v = rcv[0].innerHTML || rcv[0].innerText\n\t            //     }\n\t            //     mid = rcv[0].getAttribute('mid');\n\t            // }\n\t            Strophe.info('step 5 ----------');\n\t            Strophe.forEachChild(x, 'field', function (field) {\n\t                var fieldVar = field.getAttribute('var');\n\t                var valueDom = field.getElementsByTagName('value')[0];\n\t                Strophe.info(fieldVar);\n\t                switch (fieldVar) {\n\t                    case 'muc#roomconfig_roomname':\n\t                        _setText(valueDom, options.subject || '');\n\t                        break;\n\t                    case 'muc#roomconfig_roomdesc':\n\t                        _setText(valueDom, options.description || '');\n\t                        break;\n\t                    case 'muc#roomconfig_publicroom': // public 1\n\t                        _setText(valueDom, +options.optionsPublic);\n\t                        break;\n\t                    case 'muc#roomconfig_membersonly':\n\t                        _setText(valueDom, +options.optionsMembersOnly);\n\t                        break;\n\t                    case 'muc#roomconfig_moderatedroom':\n\t                        _setText(valueDom, +options.optionsModerate);\n\t                        break;\n\t                    case 'muc#roomconfig_persistentroom':\n\t                        _setText(valueDom, 1);\n\t                        break;\n\t                    case 'muc#roomconfig_allowinvites':\n\t                        _setText(valueDom, +options.optionsAllowInvites);\n\t                        break;\n\t                    case 'muc#roomconfig_allowvisitornickchange':\n\t                        _setText(valueDom, 0);\n\t                        break;\n\t                    case 'muc#roomconfig_allowvisitorstatus':\n\t                        _setText(valueDom, 0);\n\t                        break;\n\t                    case 'allow_private_messages':\n\t                        _setText(valueDom, 0);\n\t                        break;\n\t                    case 'allow_private_messages_from_visitors':\n\t                        _setText(valueDom, 'nobody');\n\t                        break;\n\t                    default:\n\t                        break;\n\t                }\n\t                // log(valueDom);\n\t            });\n\n\t            var iq = $iq({to: toRoom, type: 'set'})\n\t                .c('query', {xmlns: 'http://jabber.org/protocol/muc#owner'})\n\t                .cnode(x);\n\n\t            // log(iq.tree());\n\n\t            me.context.stropheConn.sendIQ(iq.tree(), function (msgInfo) {\n\t                // sucFn(msgInfo);\n\n\t                me.addGroupMembers({\n\t                    list: options.members,\n\t                    roomId: roomId\n\t                });\n\t            }, function (errInfo) {\n\t                // errFn(errInfo);\n\t            });\n\t            // sucFn(msgInfo);\n\t        }, function (errInfo) {\n\t            // errFn(errInfo);\n\t        });\n\t    }, 1000);\n\t};\n\n\tfunction _setText(valueDom, v) {\n\t    if ('textContent' in valueDom) {\n\t        valueDom.textContent = v;\n\t    } else if ('text' in valueDom) {\n\t        valueDom.text = v;\n\t    } else {\n\t        // Strophe.info('_setText 4 ----------');\n\t        // valueDom.innerHTML = v;\n\t    }\n\t}\n\n\n\tvar WebIM = window.WebIM || {};\n\tWebIM.connection = connection;\n\tWebIM.utils = _utils;\n\tWebIM.statusCode = _code;\n\tWebIM.message = _msg.message;\n\tWebIM.doQuery = function (str, suc, fail) {\n\t    if (typeof window.cefQuery === 'undefined') {\n\t        return;\n\t    }\n\t    window.cefQuery({\n\t            request: str,\n\t            persistent: false,\n\t            onSuccess: suc,\n\t            onFailure: fail\n\t        }\n\t    );\n\t};\n\n\tmodule.exports = WebIM;\n\n\tif (false) {\n\t    module.hot.accept();\n\t}\n\n/***/ },\n/* 2 */\n/***/ function(module, exports) {\n\n\t;\n\t(function () {\n\n\t    exports.code = {\n\t        WEBIM_CONNCTION_USER_NOT_ASSIGN_ERROR: 0,\n\t        WEBIM_CONNCTION_OPEN_ERROR: 1,\n\t        WEBIM_CONNCTION_AUTH_ERROR: 2,\n\t        WEBIM_CONNCTION_OPEN_USERGRID_ERROR: 3,\n\t        WEBIM_CONNCTION_ATTACH_ERROR: 4,\n\t        WEBIM_CONNCTION_ATTACH_USERGRID_ERROR: 5,\n\t        WEBIM_CONNCTION_REOPEN_ERROR: 6,\n\t        WEBIM_CONNCTION_SERVER_CLOSE_ERROR: 7,  //7: client-side network offline (net::ERR_INTERNET_DISCONNECTED)\n\t        WEBIM_CONNCTION_SERVER_ERROR: 8,        //8: offline by multi login\n\t        WEBIM_CONNCTION_IQ_ERROR: 9,\n\n\t        WEBIM_CONNCTION_PING_ERROR: 10,\n\t        WEBIM_CONNCTION_NOTIFYVERSION_ERROR: 11,\n\t        WEBIM_CONNCTION_GETROSTER_ERROR: 12,\n\t        WEBIM_CONNCTION_CROSSDOMAIN_ERROR: 13,\n\t        WEBIM_CONNCTION_LISTENING_OUTOF_MAXRETRIES: 14,\n\t        WEBIM_CONNCTION_RECEIVEMSG_CONTENTERROR: 15,\n\t        WEBIM_CONNCTION_DISCONNECTED: 16,    //16: server-side close the websocket connection\n\t        WEBIM_CONNCTION_AJAX_ERROR: 17,\n\t        WEBIM_CONNCTION_JOINROOM_ERROR: 18,\n\t        WEBIM_CONNCTION_GETROOM_ERROR: 19,\n\n\t        WEBIM_CONNCTION_GETROOMINFO_ERROR: 20,\n\t        WEBIM_CONNCTION_GETROOMMEMBER_ERROR: 21,\n\t        WEBIM_CONNCTION_GETROOMOCCUPANTS_ERROR: 22,\n\t        WEBIM_CONNCTION_LOAD_CHATROOM_ERROR: 23,\n\t        WEBIM_CONNCTION_NOT_SUPPORT_CHATROOM_ERROR: 24,\n\t        WEBIM_CONNCTION_JOINCHATROOM_ERROR: 25,\n\t        WEBIM_CONNCTION_QUITCHATROOM_ERROR: 26,\n\t        WEBIM_CONNCTION_APPKEY_NOT_ASSIGN_ERROR: 27,\n\t        WEBIM_CONNCTION_TOKEN_NOT_ASSIGN_ERROR: 28,\n\t        WEBIM_CONNCTION_SESSIONID_NOT_ASSIGN_ERROR: 29,\n\n\t        WEBIM_CONNCTION_RID_NOT_ASSIGN_ERROR: 30,\n\t        WEBIM_CONNCTION_CALLBACK_INNER_ERROR: 31,\n\t        WEBIM_CONNCTION_CLIENT_OFFLINE: 32,        //32: client offline\n\t        WEBIM_CONNCTION_CLIENT_LOGOUT: 33,        //33: client logout\n\t        WEBIM_CONNCTION_CLIENT_TOO_MUCH_ERROR: 34, // Over amount of the tabs a user opened in the same browser\n\t        WEBIM_CONNECTION_ACCEPT_INVITATION_FROM_GROUP: 35,\n\t        WEBIM_CONNECTION_DECLINE_INVITATION_FROM_GROUP: 36,\n\t        WEBIM_CONNECTION_ACCEPT_JOIN_GROUP: 37,\n\t        WEBIM_CONNECTION_DECLINE_JOIN_GROUP: 38,\n\t        WEBIM_CONNECTION_CLOSED: 39,\n\n\n\t        WEBIM_UPLOADFILE_BROWSER_ERROR: 100,\n\t        WEBIM_UPLOADFILE_ERROR: 101,\n\t        WEBIM_UPLOADFILE_NO_LOGIN: 102,\n\t        WEBIM_UPLOADFILE_NO_FILE: 103,\n\n\n\t        WEBIM_DOWNLOADFILE_ERROR: 200,\n\t        WEBIM_DOWNLOADFILE_NO_LOGIN: 201,\n\t        WEBIM_DOWNLOADFILE_BROWSER_ERROR: 202,\n\n\n\t        WEBIM_MESSAGE_REC_TEXT: 300,\n\t        WEBIM_MESSAGE_REC_TEXT_ERROR: 301,\n\t        WEBIM_MESSAGE_REC_EMOTION: 302,\n\t        WEBIM_MESSAGE_REC_PHOTO: 303,\n\t        WEBIM_MESSAGE_REC_AUDIO: 304,\n\t        WEBIM_MESSAGE_REC_AUDIO_FILE: 305,\n\t        WEBIM_MESSAGE_REC_VEDIO: 306,\n\t        WEBIM_MESSAGE_REC_VEDIO_FILE: 307,\n\t        WEBIM_MESSAGE_REC_FILE: 308,\n\t        WEBIM_MESSAGE_SED_TEXT: 309,\n\t        WEBIM_MESSAGE_SED_EMOTION: 310,\n\t        WEBIM_MESSAGE_SED_PHOTO: 311,\n\t        WEBIM_MESSAGE_SED_AUDIO: 312,\n\t        WEBIM_MESSAGE_SED_AUDIO_FILE: 313,\n\t        WEBIM_MESSAGE_SED_VEDIO: 314,\n\t        WEBIM_MESSAGE_SED_VEDIO_FILE: 315,\n\t        WEBIM_MESSAGE_SED_FILE: 316,\n\t        WEBIM_MESSAGE_SED_ERROR: 317,\n\n\n\t        STATUS_INIT: 400,\n\t        STATUS_DOLOGIN_USERGRID: 401,\n\t        STATUS_DOLOGIN_IM: 402,\n\t        STATUS_OPENED: 403,\n\t        STATUS_CLOSING: 404,\n\t        STATUS_CLOSED: 405,\n\t        STATUS_ERROR: 406\n\t    };\n\t}());\n\n\n/***/ },\n/* 3 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t;\n\t(function () {\n\n\t    var EMPTYFN = function () {\n\t    };\n\t    var _code = __webpack_require__(2).code;\n\t    var WEBIM_FILESIZE_LIMIT = 10485760;\n\n\t    var _createStandardXHR = function () {\n\t        try {\n\t            return new window.XMLHttpRequest();\n\t        } catch (e) {\n\t            return false;\n\t        }\n\t    };\n\n\t    var _createActiveXHR = function () {\n\t        try {\n\t            return new window.ActiveXObject('Microsoft.XMLHTTP');\n\t        } catch (e) {\n\t            return false;\n\t        }\n\t    };\n\n\t    var _xmlrequest = function (crossDomain) {\n\t        crossDomain = crossDomain || true;\n\t        var temp = _createStandardXHR() || _createActiveXHR();\n\n\t        if ('withCredentials' in temp) {\n\t            return temp;\n\t        }\n\t        if (!crossDomain) {\n\t            return temp;\n\t        }\n\t        if (typeof window.XDomainRequest === 'undefined') {\n\t            return temp;\n\t        }\n\t        var xhr = new XDomainRequest();\n\t        xhr.readyState = 0;\n\t        xhr.status = 100;\n\t        xhr.onreadystatechange = EMPTYFN;\n\t        xhr.onload = function () {\n\t            xhr.readyState = 4;\n\t            xhr.status = 200;\n\n\t            var xmlDoc = new ActiveXObject('Microsoft.XMLDOM');\n\t            xmlDoc.async = 'false';\n\t            xmlDoc.loadXML(xhr.responseText);\n\t            xhr.responseXML = xmlDoc;\n\t            xhr.response = xhr.responseText;\n\t            xhr.onreadystatechange();\n\t        };\n\t        xhr.ontimeout = xhr.onerror = function () {\n\t            xhr.readyState = 4;\n\t            xhr.status = 500;\n\t            xhr.onreadystatechange();\n\t        };\n\t        return xhr;\n\t    };\n\n\t    var _hasFlash = (function () {\n\t        if ('ActiveXObject' in window) {\n\t            try {\n\t                return new ActiveXObject('ShockwaveFlash.ShockwaveFlash');\n\t            } catch (ex) {\n\t                return 0;\n\t            }\n\t        } else {\n\t            if (navigator.plugins && navigator.plugins.length > 0) {\n\t                return navigator.plugins['Shockwave Flash'];\n\t            }\n\t        }\n\t        return 0;\n\t    }());\n\n\t    var _tmpUtilXHR = _xmlrequest(),\n\t        _hasFormData = typeof FormData !== 'undefined',\n\t        _hasBlob = typeof Blob !== 'undefined',\n\t        _isCanSetRequestHeader = _tmpUtilXHR.setRequestHeader || false,\n\t        _hasOverrideMimeType = _tmpUtilXHR.overrideMimeType || false,\n\t        _isCanUploadFileAsync = _isCanSetRequestHeader && _hasFormData,\n\t        _isCanUploadFile = _isCanUploadFileAsync || _hasFlash,\n\t        _isCanDownLoadFile = _isCanSetRequestHeader && (_hasBlob || _hasOverrideMimeType);\n\n\t    if (!Object.keys) {\n\t        Object.keys = (function () {\n\t            'use strict';\n\t            var hasOwnProperty = Object.prototype.hasOwnProperty,\n\t                hasDontEnumBug = !({toString: null}).propertyIsEnumerable('toString'),\n\t                dontEnums = [\n\t                    'toString',\n\t                    'toLocaleString',\n\t                    'valueOf',\n\t                    'hasOwnProperty',\n\t                    'isPrototypeOf',\n\t                    'propertyIsEnumerable',\n\t                    'constructor'\n\t                ],\n\t                dontEnumsLength = dontEnums.length;\n\n\t            return function (obj) {\n\t                if (typeof obj !== 'object' && (typeof obj !== 'function' || obj === null)) {\n\t                    throw new TypeError('Object.keys called on non-object');\n\t                }\n\n\t                var result = [], prop, i;\n\n\t                for (prop in obj) {\n\t                    if (hasOwnProperty.call(obj, prop)) {\n\t                        result.push(prop);\n\t                    }\n\t                }\n\n\t                if (hasDontEnumBug) {\n\t                    for (i = 0; i < dontEnumsLength; i++) {\n\t                        if (hasOwnProperty.call(obj, dontEnums[i])) {\n\t                            result.push(dontEnums[i]);\n\t                        }\n\t                    }\n\t                }\n\t                return result;\n\t            };\n\t        }());\n\t    }\n\n\t    var utils = {\n\t        hasFormData: _hasFormData,\n\n\t        hasBlob: _hasBlob,\n\n\t        emptyfn: EMPTYFN,\n\n\t        isCanSetRequestHeader: _isCanSetRequestHeader,\n\n\t        hasOverrideMimeType: _hasOverrideMimeType,\n\n\t        isCanUploadFileAsync: _isCanUploadFileAsync,\n\n\t        isCanUploadFile: _isCanUploadFile,\n\n\t        isCanDownLoadFile: _isCanDownLoadFile,\n\n\t        isSupportWss: (function () {\n\t            var notSupportList = [\n\t                //1: QQ browser X5 core\n\t                /MQQBrowser[\\/]5([.]\\d+)?\\sTBS/\n\n\t                //2: etc.\n\t                //...\n\t            ];\n\n\t            if (!window.WebSocket) {\n\t                return false;\n\t            }\n\n\t            var ua = window.navigator.userAgent;\n\t            for (var i = 0, l = notSupportList.length; i < l; i++) {\n\t                if (notSupportList[i].test(ua)) {\n\t                    return false;\n\t                }\n\t            }\n\t            return true;\n\t        }()),\n\n\t        getIEVersion: (function () {\n\t            var ua = navigator.userAgent, matches, tridentMap = {'4': 8, '5': 9, '6': 10, '7': 11};\n\n\t            matches = ua.match(/MSIE (\\d+)/i);\n\n\t            if (matches && matches[1]) {\n\t                return +matches[1];\n\t            }\n\t            matches = ua.match(/Trident\\/(\\d+)/i);\n\t            if (matches && matches[1]) {\n\t                return tridentMap[matches[1]] || null;\n\t            }\n\t            return null;\n\t        }()),\n\n\n\t        stringify: function (json) {\n\t            if (typeof JSON !== 'undefined' && JSON.stringify) {\n\t                return JSON.stringify(json);\n\t            } else {\n\t                var s = '',\n\t                    arr = [];\n\n\t                var iterate = function (json) {\n\t                    var isArr = false;\n\n\t                    if (Object.prototype.toString.call(json) === '[object Array]') {\n\t                        arr.push(']', '[');\n\t                        isArr = true;\n\t                    } else if (Object.prototype.toString.call(json) === '[object Object]') {\n\t                        arr.push('}', '{');\n\t                    }\n\n\t                    for (var o in json) {\n\t                        if (Object.prototype.toString.call(json[o]) === '[object Null]') {\n\t                            json[o] = 'null';\n\t                        } else if (Object.prototype.toString.call(json[o]) === '[object Undefined]') {\n\t                            json[o] = 'undefined';\n\t                        }\n\n\t                        if (json[o] && typeof json[o] === 'object') {\n\t                            s += ',' + (isArr ? '' : '\"' + o + '\":' + (isArr ? '\"' : '')) + iterate(json[o]) + '';\n\t                        } else {\n\t                            s += ',\"' + (isArr ? '' : o + '\":\"') + json[o] + '\"';\n\t                        }\n\t                    }\n\n\t                    if (s != '') {\n\t                        s = s.slice(1);\n\t                    }\n\n\t                    return arr.pop() + s + arr.pop();\n\t                };\n\t                return iterate(json);\n\t            }\n\t        },\n\t        login: function (options) {\n\t            var options = options || {};\n\t            var suc = options.success || EMPTYFN;\n\t            var err = options.error || EMPTYFN;\n\n\t            var appKey = options.appKey || '';\n\t            var devInfos = appKey.split('#');\n\t            if (devInfos.length !== 2) {\n\t                err({\n\t                    type: _code.WEBIM_CONNCTION_APPKEY_NOT_ASSIGN_ERROR\n\t                });\n\t                return false;\n\t            }\n\n\t            var orgName = devInfos[0];\n\t            var appName = devInfos[1];\n\t            var https = https || options.https;\n\t            var user = options.user || '';\n\t            var pwd = options.pwd || '';\n\n\t            var apiUrl = options.apiUrl;\n\n\t            var loginJson = {\n\t                grant_type: 'password',\n\t                username: user,\n\t                password: pwd,\n\t                timestamp: +new Date()\n\t            };\n\t            var loginfo = utils.stringify(loginJson);\n\n\t            var options = {\n\t                url: apiUrl + '/' + orgName + '/' + appName + '/token',\n\t                dataType: 'json',\n\t                data: loginfo,\n\t                success: suc,\n\t                error: err\n\t            };\n\t            return utils.ajax(options);\n\t        },\n\n\t        getFileUrl: function (fileInputId) {\n\t            var uri = {\n\t                url: '',\n\t                filename: '',\n\t                filetype: '',\n\t                data: ''\n\t            };\n\n\t            var fileObj = typeof fileInputId === 'string' ? document.getElementById(fileInputId) : fileInputId;\n\n\t            if (!utils.isCanUploadFileAsync || !fileObj) {\n\t                return uri;\n\t            }\n\t            try {\n\t                if (window.URL.createObjectURL) {\n\t                    var fileItems = fileObj.files;\n\t                    if (fileItems.length > 0) {\n\t                        var u = fileItems.item(0);\n\t                        uri.data = u;\n\t                        uri.url = window.URL.createObjectURL(u);\n\t                        uri.filename = u.name || '';\n\t                    }\n\t                } else { // IE\n\t                    var u = document.getElementById(fileInputId).value;\n\t                    uri.url = u;\n\t                    var pos1 = u.lastIndexOf('/');\n\t                    var pos2 = u.lastIndexOf('\\\\');\n\t                    var pos = Math.max(pos1, pos2);\n\t                    if (pos < 0)\n\t                        uri.filename = u;\n\t                    else\n\t                        uri.filename = u.substring(pos + 1);\n\t                }\n\t                var index = uri.filename.lastIndexOf('.');\n\t                if (index != -1) {\n\t                    uri.filetype = uri.filename.substring(index + 1).toLowerCase();\n\t                }\n\t                return uri;\n\n\t            } catch (e) {\n\t                throw e;\n\t            }\n\t        },\n\n\t        getFileSize: function (file) {\n\t            var fileSize = 0;\n\t            if (file) {\n\t                if (file.files) {\n\t                    if (file.files.length > 0) {\n\t                        fileSize = file.files[0].size;\n\t                    }\n\t                } else if (file.select && 'ActiveXObject' in window) {\n\t                    file.select();\n\t                    var fileobject = new ActiveXObject('Scripting.FileSystemObject');\n\t                    var file = fileobject.GetFile(file.value);\n\t                    fileSize = file.Size;\n\t                }\n\t            }\n\t            console.log('fileSize: ', fileSize);\n\t            if(fileSize > 10000000){\n\t                return false;\n\t            }\n\t            var kb = Math.round(fileSize / 1000);\n\t            if(kb < 1000){\n\t                fileSize = kb + ' KB';\n\t            }else if(kb >= 1000){\n\t                var mb = kb / 1000;\n\t                if(mb < 1000) {\n\t                    fileSize = mb.toFixed(1) + ' MB';\n\t                }else{\n\t                    var gb = mb / 1000;\n\t                    fileSize = gb.toFixed(1) + ' GB';\n\t                }\n\t            }\n\t            return fileSize;\n\t        },\n\n\t        hasFlash: _hasFlash,\n\n\t        trim: function (str) {\n\n\t            str = typeof str === 'string' ? str : '';\n\n\t            return str.trim\n\t                ? str.trim()\n\t                : str.replace(/^\\s|\\s$/g, '');\n\t        },\n\n\t        parseEmoji: function (msg) {\n\t            if (typeof WebIM.Emoji === 'undefined' || typeof WebIM.Emoji.map === 'undefined') {\n\t                return msg;\n\t            } else {\n\t                var emoji = WebIM.Emoji,\n\t                    reg = null;\n\n\t                for (var face in emoji.map) {\n\t                    if (emoji.map.hasOwnProperty(face)) {\n\t                        while (msg.indexOf(face) > -1) {\n\t                            msg = msg.replace(face, '<img class=\"emoji\" src=\"' + emoji.path + emoji.map[face] + '\" />');\n\t                        }\n\t                    }\n\t                }\n\t                return msg;\n\t            }\n\t        },\n\n\t        parseLink: function (msg) {\n\n\t            var reg = /(https?\\:\\/\\/|www\\.)([a-zA-Z0-9-]+(\\.[a-zA-Z0-9]+)+)(\\:[0-9]{2,4})?\\/?((\\.[:_0-9a-zA-Z-]+)|[:_0-9a-zA-Z-]*\\/?)*\\??[:_#@*&%0-9a-zA-Z-/=]*/gm;\n\n\t            msg = msg.replace(reg, function (v) {\n\n\t                var prefix = /^https?/gm.test(v);\n\n\t                return \"<a href='\"\n\t                    + (prefix ? v : '//' + v)\n\t                    + \"' target='_blank'>\"\n\t                    + v\n\t                    + \"</a>\";\n\n\t            });\n\n\t            return msg;\n\n\t        },\n\n\t        parseJSON: function (data) {\n\n\t            if (window.JSON && window.JSON.parse) {\n\t                return window.JSON.parse(data + '');\n\t            }\n\n\t            var requireNonComma,\n\t                depth = null,\n\t                str = utils.trim(data + '');\n\n\t            return str && !utils.trim(\n\t                str.replace(/(,)|(\\[|{)|(}|])|\"(?:[^\"\\\\\\r\\n]|\\\\[\"\\\\\\/bfnrt]|\\\\u[\\da-fA-F]{4})*\"\\s*:?|true|false|null|-?(?!0\\d)\\d+(?:\\.\\d+|)(?:[eE][+-]?\\d+|)/g\n\t                    , function (token, comma, open, close) {\n\n\t                        if (requireNonComma && comma) {\n\t                            depth = 0;\n\t                        }\n\n\t                        if (depth === 0) {\n\t                            return token;\n\t                        }\n\n\t                        requireNonComma = open || comma;\n\t                        depth += !close - !open;\n\t                        return '';\n\t                    })\n\t            )\n\t                ? (Function('return ' + str))()\n\t                : (Function('Invalid JSON: ' + data))();\n\t        },\n\n\t        parseUploadResponse: function (response) {\n\t            return response.indexOf('callback') > -1 ? //lte ie9\n\t                response.slice(9, -1) : response;\n\t        },\n\n\t        parseDownloadResponse: function (response) {\n\t            return ((response && response.type && response.type === 'application/json')\n\t            || 0 > Object.prototype.toString.call(response).indexOf('Blob'))\n\t                ? this.url + '?token=' : window.URL.createObjectURL(response);\n\t        },\n\n\t        uploadFile: function (options) {\n\t            var options = options || {};\n\t            options.onFileUploadProgress = options.onFileUploadProgress || EMPTYFN;\n\t            options.onFileUploadComplete = options.onFileUploadComplete || EMPTYFN;\n\t            options.onFileUploadError = options.onFileUploadError || EMPTYFN;\n\t            options.onFileUploadCanceled = options.onFileUploadCanceled || EMPTYFN;\n\n\t            var acc = options.accessToken || this.context.accessToken;\n\t            if (!acc) {\n\t                options.onFileUploadError({\n\t                    type: _code.WEBIM_UPLOADFILE_NO_LOGIN\n\t                    , id: options.id\n\t                });\n\t                return;\n\t            }\n\n\t            var orgName, appName, devInfos;\n\t            var appKey = options.appKey || this.context.appKey || '';\n\n\t            if (appKey) {\n\t                devInfos = appKey.split('#');\n\t                orgName = devInfos[0];\n\t                appName = devInfos[1];\n\t            }\n\n\t            if (!orgName && !appName) {\n\t                options.onFileUploadError({\n\t                    type: _code.WEBIM_UPLOADFILE_ERROR\n\t                    , id: options.id\n\t                });\n\t                return;\n\t            }\n\n\t            var apiUrl = options.apiUrl;\n\t            var uploadUrl = apiUrl + '/' + orgName + '/' + appName + '/chatfiles';\n\n\t            if (!utils.isCanUploadFileAsync) {\n\t                if (utils.hasFlash && typeof options.flashUpload === 'function') {\n\t                    options.flashUpload && options.flashUpload(uploadUrl, options);\n\t                } else {\n\t                    options.onFileUploadError({\n\t                        type: _code.WEBIM_UPLOADFILE_BROWSER_ERROR\n\t                        , id: options.id\n\t                    });\n\t                }\n\t                return;\n\t            }\n\n\t            var fileSize = options.file.data ? options.file.data.size : undefined;\n\t            if (fileSize > WEBIM_FILESIZE_LIMIT) {\n\t                options.onFileUploadError({\n\t                    type: _code.WEBIM_UPLOADFILE_ERROR\n\t                    , id: options.id\n\t                });\n\t                return;\n\t            } else if (fileSize <= 0) {\n\t                options.onFileUploadError({\n\t                    type: _code.WEBIM_UPLOADFILE_ERROR\n\t                    , id: options.id\n\t                });\n\t                return;\n\t            }\n\n\t            var xhr = utils.xmlrequest();\n\t            var onError = function (e) {\n\t                options.onFileUploadError({\n\t                    type: _code.WEBIM_UPLOADFILE_ERROR,\n\t                    id: options.id,\n\t                    xhr: xhr\n\t                });\n\t            };\n\t            if (xhr.upload) {\n\t                xhr.upload.addEventListener('progress', options.onFileUploadProgress, false);\n\t            }\n\t            if (xhr.addEventListener) {\n\t                xhr.addEventListener('abort', options.onFileUploadCanceled, false);\n\t                xhr.addEventListener('load', function (e) {\n\t                    try {\n\t                        var json = utils.parseJSON(xhr.responseText);\n\t                        try {\n\t                            options.onFileUploadComplete(json);\n\t                        } catch (e) {\n\t                            options.onFileUploadError({\n\t                                type: _code.WEBIM_CONNCTION_CALLBACK_INNER_ERROR\n\t                                , data: e\n\t                            });\n\t                        }\n\t                    } catch (e) {\n\t                        options.onFileUploadError({\n\t                            type: _code.WEBIM_UPLOADFILE_ERROR,\n\t                            data: xhr.responseText,\n\t                            id: options.id,\n\t                            xhr: xhr\n\t                        });\n\t                    }\n\t                }, false);\n\t                xhr.addEventListener('error', onError, false);\n\t            } else if (xhr.onreadystatechange) {\n\t                xhr.onreadystatechange = function () {\n\t                    if (xhr.readyState === 4) {\n\t                        if (ajax.status === 200) {\n\t                            try {\n\t                                var json = utils.parseJSON(xhr.responseText);\n\t                                options.onFileUploadComplete(json);\n\t                            } catch (e) {\n\t                                options.onFileUploadError({\n\t                                    type: _code.WEBIM_UPLOADFILE_ERROR,\n\t                                    data: xhr.responseText,\n\t                                    id: options.id,\n\t                                    xhr: xhr\n\t                                });\n\t                            }\n\t                        } else {\n\t                            options.onFileUploadError({\n\t                                type: _code.WEBIM_UPLOADFILE_ERROR,\n\t                                data: xhr.responseText,\n\t                                id: options.id,\n\t                                xhr: xhr\n\t                            });\n\t                        }\n\t                    } else {\n\t                        xhr.abort();\n\t                        options.onFileUploadCanceled();\n\t                    }\n\t                }\n\t            }\n\n\t            xhr.open('POST', uploadUrl);\n\n\t            xhr.setRequestHeader('restrict-access', 'true');\n\t            xhr.setRequestHeader('Accept', '*/*');// Android QQ browser has some problem with this attribute.\n\t            xhr.setRequestHeader('Authorization', 'Bearer ' + acc);\n\n\t            var formData = new FormData();\n\t            formData.append('file', options.file.data);\n\t            xhr.send(formData);\n\t        },\n\n\n\t        download: function (options) {\n\t            options.onFileDownloadComplete = options.onFileDownloadComplete || EMPTYFN;\n\t            options.onFileDownloadError = options.onFileDownloadError || EMPTYFN;\n\n\t            var accessToken = options.accessToken || this.context.accessToken;\n\t            if (!accessToken) {\n\t                options.onFileDownloadError({\n\t                    type: _code.WEBIM_DOWNLOADFILE_NO_LOGIN,\n\t                    id: options.id\n\t                });\n\t                return;\n\t            }\n\n\t            var onError = function (e) {\n\t                options.onFileDownloadError({\n\t                    type: _code.WEBIM_DOWNLOADFILE_ERROR,\n\t                    id: options.id,\n\t                    xhr: xhr\n\t                });\n\t            };\n\n\t            if (!utils.isCanDownLoadFile) {\n\t                options.onFileDownloadComplete();\n\t                return;\n\t            }\n\t            var xhr = utils.xmlrequest();\n\t            if ('addEventListener' in xhr) {\n\t                xhr.addEventListener('load', function (e) {\n\t                    options.onFileDownloadComplete(xhr.response, xhr);\n\t                }, false);\n\t                xhr.addEventListener('error', onError, false);\n\t            } else if ('onreadystatechange' in xhr) {\n\t                xhr.onreadystatechange = function () {\n\t                    if (xhr.readyState === 4) {\n\t                        if (ajax.status === 200) {\n\t                            options.onFileDownloadComplete(xhr.response, xhr);\n\t                        } else {\n\t                            options.onFileDownloadError({\n\t                                type: _code.WEBIM_DOWNLOADFILE_ERROR,\n\t                                id: options.id,\n\t                                xhr: xhr\n\t                            });\n\t                        }\n\t                    } else {\n\t                        xhr.abort();\n\t                        options.onFileDownloadError({\n\t                            type: _code.WEBIM_DOWNLOADFILE_ERROR,\n\t                            id: options.id,\n\t                            xhr: xhr\n\t                        });\n\t                    }\n\t                }\n\t            }\n\n\t            var method = options.method || 'GET';\n\t            var resType = options.responseType || 'blob';\n\t            var mimeType = options.mimeType || 'text/plain; charset=x-user-defined';\n\t            xhr.open(method, options.url);\n\t            if (typeof Blob !== 'undefined') {\n\t                xhr.responseType = resType;\n\t            } else {\n\t                xhr.overrideMimeType(mimeType);\n\t            }\n\n\t            var innerHeaer = {\n\t                'X-Requested-With': 'XMLHttpRequest',\n\t                'Accept': 'application/octet-stream',\n\t                'share-secret': options.secret,\n\t                'Authorization': 'Bearer ' + accessToken\n\t            };\n\t            var headers = options.headers || {};\n\t            for (var key in headers) {\n\t                innerHeaer[key] = headers[key];\n\t            }\n\t            for (var key in innerHeaer) {\n\t                if (innerHeaer[key]) {\n\t                    xhr.setRequestHeader(key, innerHeaer[key]);\n\t                }\n\t            }\n\t            xhr.send(null);\n\t        },\n\n\t        parseTextMessage: function (message, faces) {\n\t            if (typeof message !== 'string') {\n\t                return;\n\t            }\n\n\t            if (Object.prototype.toString.call(faces) !== '[object Object]') {\n\t                return {\n\t                    isemoji: false,\n\t                    body: [\n\t                        {\n\t                            type: 'txt',\n\t                            data: message\n\t                        }\n\t                    ]\n\t                };\n\t            }\n\n\t            var receiveMsg = message;\n\t            var emessage = [];\n\t            var expr = /\\[[^[\\]]{2,3}\\]/mg;\n\t            var emoji = receiveMsg.match(expr);\n\n\t            if (!emoji || emoji.length < 1) {\n\t                return {\n\t                    isemoji: false,\n\t                    body: [\n\t                        {\n\t                            type: 'txt',\n\t                            data: message\n\t                        }\n\t                    ]\n\t                };\n\t            }\n\t            var isemoji = false;\n\t            for (var i = 0; i < emoji.length; i++) {\n\t                var tmsg = receiveMsg.substring(0, receiveMsg.indexOf(emoji[i])),\n\t                    existEmoji = WebIM.Emoji.map[emoji[i]];\n\n\t                if (tmsg) {\n\t                    emessage.push({\n\t                        type: 'txt',\n\t                        data: tmsg\n\t                    });\n\t                }\n\t                if (!existEmoji) {\n\t                    emessage.push({\n\t                        type: 'txt',\n\t                        data: emoji[i]\n\t                    });\n\t                    continue;\n\t                }\n\t                var emojiStr = WebIM.Emoji.map ? WebIM.Emoji.path + existEmoji : null;\n\n\t                if (emojiStr) {\n\t                    isemoji = true;\n\t                    emessage.push({\n\t                        type: 'emoji',\n\t                        data: emojiStr\n\t                    });\n\t                } else {\n\t                    emessage.push({\n\t                        type: 'txt',\n\t                        data: emoji[i]\n\t                    });\n\t                }\n\t                var restMsgIndex = receiveMsg.indexOf(emoji[i]) + emoji[i].length;\n\t                receiveMsg = receiveMsg.substring(restMsgIndex);\n\t            }\n\t            if (receiveMsg) {\n\t                emessage.push({\n\t                    type: 'txt',\n\t                    data: receiveMsg\n\t                });\n\t            }\n\t            if (isemoji) {\n\t                return {\n\t                    isemoji: isemoji,\n\t                    body: emessage\n\t                };\n\t            }\n\t            return {\n\t                isemoji: false,\n\t                body: [\n\t                    {\n\t                        type: 'txt',\n\t                        data: message\n\t                    }\n\t                ]\n\t            };\n\t        },\n\n\t        xmlrequest: _xmlrequest,\n\n\n\t        getXmlFirstChild: function (data, tagName) {\n\t            var children = data.getElementsByTagName(tagName);\n\t            if (children.length == 0) {\n\t                return null;\n\t            } else {\n\t                return children[0];\n\t            }\n\t        },\n\t        ajax: function (options) {\n\t            var dataType = options.dataType || 'text';\n\t            var suc = options.success || EMPTYFN;\n\t            var error = options.error || EMPTYFN;\n\t            var xhr = utils.xmlrequest();\n\n\t            xhr.onreadystatechange = function () {\n\t                if (xhr.readyState === 4) {\n\t                    var status = xhr.status || 0;\n\t                    if (status === 200) {\n\t                        try {\n\t                            switch (dataType) {\n\t                                case 'text':\n\t                                    suc(xhr.responseText);\n\t                                    return;\n\t                                case 'json':\n\t                                    var json = utils.parseJSON(xhr.responseText);\n\t                                    suc(json, xhr);\n\t                                    return;\n\t                                case 'xml':\n\t                                    if (xhr.responseXML && xhr.responseXML.documentElement) {\n\t                                        suc(xhr.responseXML.documentElement, xhr);\n\t                                    } else {\n\t                                        error({\n\t                                            type: _code.WEBIM_CONNCTION_AJAX_ERROR,\n\t                                            data: xhr.responseText\n\t                                        });\n\t                                    }\n\t                                    return;\n\t                            }\n\t                            suc(xhr.response || xhr.responseText, xhr);\n\t                        } catch (e) {\n\t                            error({\n\t                                type: _code.WEBIM_CONNCTION_AJAX_ERROR,\n\t                                data: e\n\t                            });\n\t                        }\n\t                        return;\n\t                    } else {\n\t                        error({\n\t                            type: _code.WEBIM_CONNCTION_AJAX_ERROR,\n\t                            data: xhr.responseText\n\t                        });\n\t                        return;\n\t                    }\n\t                }\n\t                if (xhr.readyState === 0) {\n\t                    error({\n\t                        type: _code.WEBIM_CONNCTION_AJAX_ERROR,\n\t                        data: xhr.responseText\n\t                    });\n\t                }\n\t            };\n\n\t            if (options.responseType) {\n\t                if (xhr.responseType) {\n\t                    xhr.responseType = options.responseType;\n\t                }\n\t            }\n\t            if (options.mimeType) {\n\t                if (utils.hasOverrideMimeType) {\n\t                    xhr.overrideMimeType(options.mimeType);\n\t                }\n\t            }\n\n\t            var type = options.type || 'POST',\n\t                data = options.data || null,\n\t                tempData = '';\n\n\t            if (type.toLowerCase() === 'get' && data) {\n\t                for (var o in data) {\n\t                    if (data.hasOwnProperty(o)) {\n\t                        tempData += o + '=' + data[o] + '&';\n\t                    }\n\t                }\n\t                tempData = tempData ? tempData.slice(0, -1) : tempData;\n\t                options.url += (options.url.indexOf('?') > 0 ? '&' : '?') + (tempData ? tempData + '&' : tempData) + '_v=' + new Date().getTime();\n\t                data = null;\n\t                tempData = null;\n\t            }\n\t            xhr.open(type, options.url);\n\n\t            if (utils.isCanSetRequestHeader) {\n\t                var headers = options.headers || {};\n\t                for (var key in headers) {\n\t                    if (headers.hasOwnProperty(key)) {\n\t                        xhr.setRequestHeader(key, headers[key]);\n\t                    }\n\t                }\n\t            }\n\n\t            xhr.send(data);\n\t            return xhr;\n\t        },\n\t        ts: function () {\n\t            var d = new Date();\n\t            var Hours = d.getHours(); //获取当前小时数(0-23)\n\t            var Minutes = d.getMinutes(); //获取当前分钟数(0-59)\n\t            var Seconds = d.getSeconds(); //获取当前秒数(0-59)\n\t            var Milliseconds = d.getMilliseconds(); //获取当前毫秒\n\t            return (Hours < 10 ? \"0\" + Hours : Hours) + ':' + (Minutes < 10 ? \"0\" + Minutes : Minutes) + ':' + (Seconds < 10 ? \"0\" + Seconds : Seconds) + ':' + Milliseconds + ' ';\n\t        },\n\n\t        getObjectKey: function (obj, val) {\n\t            for (var key in obj) {\n\t                if (obj[key] == val) {\n\t                    return key;\n\t                }\n\t            }\n\t            return '';\n\t        }\n\n\t    };\n\n\n\t    exports.utils = utils;\n\t}());\n\n\n/***/ },\n/* 4 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t;(function () {\n\t    'use strict';\n\n\t    var _utils = __webpack_require__(3).utils;\n\t    var Message = function (type, id) {\n\t        if (!this instanceof Message) {\n\t            return new Message(type);\n\t        }\n\n\t        this._msg = {};\n\n\t        if (typeof Message[type] === 'function') {\n\t            Message[type].prototype.setGroup = this.setGroup;\n\t            this._msg = new Message[type](id);\n\t        }\n\t        return this._msg;\n\t    }\n\t    Message.prototype.setGroup = function (group) {\n\t        this.body.group = group;\n\t    }\n\n\n\t    /*\n\t     * text message\n\t     */\n\t    Message.txt = function (id) {\n\t        this.id = id;\n\t        this.type = 'txt';\n\t        this.body = {};\n\t    };\n\t    Message.txt.prototype.set = function (opt) {\n\t        this.value = opt.msg;\n\t        this.body = {\n\t            id: this.id\n\t            , to: opt.to\n\t            , msg: this.value\n\t            , type: this.type\n\t            , roomType: opt.roomType\n\t            , ext: opt.ext || {}\n\t            , success: opt.success\n\t            , fail: opt.fail\n\t        };\n\n\t        !opt.roomType && delete this.body.roomType;\n\n\t    };\n\n\t    /*\n\t     * cmd message\n\t     */\n\t    Message.cmd = function (id) {\n\t        this.id = id;\n\t        this.type = 'cmd';\n\t        this.body = {};\n\t    };\n\t    Message.cmd.prototype.set = function (opt) {\n\t        this.value = '';\n\n\t        this.body = {\n\t            to: opt.to\n\t            , action: opt.action\n\t            , msg: this.value\n\t            , type: this.type\n\t            , roomType: opt.roomType\n\t            , ext: opt.ext || {}\n\t            , success: opt.success\n\t        };\n\t        !opt.roomType && delete this.body.roomType;\n\t    };\n\n\t    /*\n\t     * loc message\n\t     */\n\t    Message.location = function (id) {\n\t        this.id = id;\n\t        this.type = 'loc';\n\t        this.body = {};\n\t    };\n\t    Message.location.prototype.set = function (opt) {\n\t        this.body = {\n\t            to: opt.to\n\t            , type: this.type\n\t            , roomType: opt.roomType\n\t            , addr: opt.addr\n\t            , lat: opt.lat\n\t            , lng: opt.lng\n\t            , ext: opt.ext || {}\n\t        };\n\t    };\n\n\t    /*\n\t     * img message\n\t     */\n\t    Message.img = function (id) {\n\t        this.id = id;\n\t        this.type = 'img';\n\t        this.body = {};\n\t    };\n\t    Message.img.prototype.set = function (opt) {\n\t        opt.file = opt.file || _utils.getFileUrl(opt.fileInputId);\n\n\t        this.value = opt.file;\n\n\t        this.body = {\n\t            id: this.id,\n\t            file: this.value,\n\t            apiUrl: opt.apiUrl,\n\t            to: opt.to,\n\t            type: this.type,\n\t            ext: opt.ext || {},\n\t            roomType: opt.roomType,\n\t            onFileUploadError: opt.onFileUploadError,\n\t            onFileUploadComplete: opt.onFileUploadComplete,\n\t            success: opt.success,\n\t            fail: opt.fail,\n\t            flashUpload: opt.flashUpload,\n\t            width: opt.width,\n\t            height: opt.height,\n\t            body: opt.body,\n\t            uploadError: opt.uploadError,\n\t            uploadComplete: opt.uploadComplete\n\t        };\n\n\t        !opt.roomType && delete this.body.roomType;\n\t    };\n\n\t    /*\n\t     * audio message\n\t     */\n\t    Message.audio = function (id) {\n\t        this.id = id;\n\t        this.type = 'audio';\n\t        this.body = {};\n\t    };\n\t    Message.audio.prototype.set = function (opt) {\n\t        opt.file = opt.file || _utils.getFileUrl(opt.fileInputId);\n\n\t        this.value = opt.file;\n\t        this.filename = opt.filename || this.value.filename;\n\n\t        this.body = {\n\t            id: this.id\n\t            , file: this.value\n\t            , filename: this.filename\n\t            , apiUrl: opt.apiUrl\n\t            , to: opt.to\n\t            , type: this.type\n\t            , ext: opt.ext || {}\n\t            , length: opt.length || 0\n\t            , roomType: opt.roomType\n\t            , file_length: opt.file_length\n\t            , onFileUploadError: opt.onFileUploadError\n\t            , onFileUploadComplete: opt.onFileUploadComplete\n\t            , success: opt.success\n\t            , fail: opt.fail\n\t            , flashUpload: opt.flashUpload\n\t            , body: opt.body\n\t        };\n\t        !opt.roomType && delete this.body.roomType;\n\t    };\n\n\t    /*\n\t     * file message\n\t     */\n\t    Message.file = function (id) {\n\t        this.id = id;\n\t        this.type = 'file';\n\t        this.body = {};\n\t    };\n\t    Message.file.prototype.set = function (opt) {\n\t        opt.file = opt.file || _utils.getFileUrl(opt.fileInputId);\n\n\t        this.value = opt.file;\n\t        this.filename = opt.filename || this.value.filename;\n\n\t        this.body = {\n\t            id: this.id\n\t            , file: this.value\n\t            , filename: this.filename\n\t            , apiUrl: opt.apiUrl\n\t            , to: opt.to\n\t            , type: this.type\n\t            , ext: opt.ext || {}\n\t            , roomType: opt.roomType\n\t            , onFileUploadError: opt.onFileUploadError\n\t            , onFileUploadComplete: opt.onFileUploadComplete\n\t            , success: opt.success\n\t            , fail: opt.fail\n\t            , flashUpload: opt.flashUpload\n\t            , body: opt.body\n\t        };\n\t        !opt.roomType && delete this.body.roomType;\n\t    };\n\n\t    /*\n\t     * video message\n\t     */\n\t    Message.video = function (id) {\n\n\t    };\n\t    Message.video.prototype.set = function (opt) {\n\n\t    };\n\n\t    var _Message = function (message) {\n\n\t        if (!this instanceof _Message) {\n\t            return new _Message(message, conn);\n\t        }\n\n\t        this.msg = message;\n\t    };\n\n\t    _Message.prototype.send = function (conn) {\n\t        var me = this;\n\n\t        var _send = function (message) {\n\n\t            message.ext = message.ext || {};\n\t            message.ext.weichat = message.ext.weichat || {};\n\t            message.ext.weichat.originType = message.ext.weichat.originType || 'webim';\n\n\t            var json = {\n\t                from: conn.context.userId || ''\n\t                , to: message.to\n\t                , bodies: [message.body]\n\t                , ext: message.ext || {}\n\t            };\n\n\t            var jsonstr = _utils.stringify(json);\n\t            var dom = $msg({\n\t                type: message.group || 'chat'\n\t                , to: message.toJid\n\t                , id: message.id\n\t                , xmlns: 'jabber:client'\n\t            }).c('body').t(jsonstr);\n\n\t            if (message.roomType) {\n\t                dom.up().c('roomtype', {xmlns: 'easemob:x:roomtype', type: 'chatroom'});\n\t            }\n\n\t            setTimeout(function () {\n\t                if (typeof _msgHash !== 'undefined' && _msgHash[message.id]) {\n\t                    _msgHash[message.id].msg.fail instanceof Function\n\t                    && _msgHash[message.id].msg.fail(message.id);\n\t                }\n\t            }, 60000);\n\t            conn.sendCommand(dom.tree(), message.id);\n\t        };\n\n\n\t        if (me.msg.file) {\n\t            if (me.msg.body && me.msg.body.url) {// Only send msg\n\t                _send(me.msg);\n\t                return;\n\t            }\n\t            var _tmpComplete = me.msg.onFileUploadComplete;\n\t            var _complete = function (data) {\n\n\t                if (data.entities[0]['file-metadata']) {\n\t                    var file_len = data.entities[0]['file-metadata']['content-length'];\n\t                    me.msg.file_length = file_len;\n\t                    me.msg.filetype = data.entities[0]['file-metadata']['content-type'];\n\t                    if (file_len > 204800) {\n\t                        me.msg.thumbnail = true;\n\t                    }\n\t                }\n\n\t                me.msg.body = {\n\t                    type: me.msg.type || 'file'\n\t                    ,\n\t                    url: ((location.protocol != 'https:' && conn.isHttpDNS) ? (conn.apiUrl + data.uri.substr(data.uri.indexOf(\"/\", 9))) : data.uri) + '/' + data.entities[0]['uuid']\n\t                    , secret: data.entities[0]['share-secret']\n\t                    , filename: me.msg.file.filename || me.msg.filename\n\t                    , size: {\n\t                        width: me.msg.width || 0\n\t                        , height: me.msg.height || 0\n\t                    }\n\t                    , length: me.msg.length || 0\n\t                    , file_length: me.msg.file_length || 0\n\t                    , filetype: me.msg.filetype\n\t                }\n\t                _send(me.msg);\n\t                _tmpComplete instanceof Function && _tmpComplete(data, me.msg.id);\n\t            };\n\n\t            me.msg.onFileUploadComplete = _complete;\n\t            _utils.uploadFile.call(conn, me.msg);\n\t        } else {\n\t            me.msg.body = {\n\t                type: me.msg.type === 'chat' ? 'txt' : me.msg.type\n\t                , msg: me.msg.msg\n\t            };\n\t            if (me.msg.type === 'cmd') {\n\t                me.msg.body.action = me.msg.action;\n\t            } else if (me.msg.type === 'loc') {\n\t                me.msg.body.addr = me.msg.addr;\n\t                me.msg.body.lat = me.msg.lat;\n\t                me.msg.body.lng = me.msg.lng;\n\t            }\n\n\t            _send(me.msg);\n\t        }\n\t    };\n\n\t    exports._msg = _Message;\n\t    exports.message = Message;\n\t}());\n\n\n/***/ },\n/* 5 */\n/***/ function(module, exports) {\n\n\t;(function () {\n\t    function Array_h(length) {\n\t        this.array = length === undefined ? [] : new Array(length);\n\t    }\n\n\t    Array_h.prototype = {\n\t        /**\n\t         * 返回数组长度\n\t         *\n\t         * @return {Number} length [数组长度]\n\t         */\n\t        length: function () {\n\t            return this.array.length;\n\t        },\n\n\t        at: function (index) {\n\t            return this.array[index];\n\t        },\n\n\t        set: function (index, obj) {\n\t            this.array[index] = obj;\n\t        },\n\n\t        /**\n\t         * 向数组的末尾添加一个或多个元素，并返回新的长度。\n\t         *\n\t         * @param  {*} obj [description]\n\t         * @return {Number} length [新数组的长度]\n\t         */\n\t        push: function (obj) {\n\t            return this.array.push(obj);\n\t        },\n\n\t        /**\n\t         * 返回数组中选定的元素\n\t         *\n\t         * @param  {Number} start [开始索引值]\n\t         * @param  {Number} end [结束索引值]\n\t         * @return {Array} newArray  [新的数组]\n\t         */\n\t        slice: function (start, end) {\n\t            return this.array = this.array.slice(start, end);\n\t        },\n\n\t        concat: function (array) {\n\t            this.array = this.array.concat(array);\n\t        },\n\n\t        remove: function (index, count) {\n\t            count = count === undefined ? 1 : count;\n\t            this.array.splice(index, count);\n\t        },\n\n\t        join: function (separator) {\n\t            return this.array.join(separator);\n\t        },\n\n\t        clear: function () {\n\t            this.array.length = 0;\n\t        }\n\t    };\n\n\t    /**\n\t     * 先进先出队列 (First Input First Output)\n\t     *\n\t     * 一种先进先出的数据缓存器\n\t     */\n\t    var Queue = function () {\n\t        this._array_h = new Array_h();\n\t    };\n\n\t    Queue.prototype = {\n\t        _index: 0,\n\n\t        /**\n\t         * 排队\n\t         *\n\t         * @param  {Object} obj [description]\n\t         * @return {[type]}     [description]\n\t         */\n\t        push: function (obj) {\n\t            this._array_h.push(obj);\n\t        },\n\n\t        /**\n\t         * 出队\n\t         *\n\t         * @return {Object} [description]\n\t         */\n\t        pop: function () {\n\t            var ret = null;\n\t            if (this._array_h.length()) {\n\t                ret = this._array_h.at(this._index);\n\t                if (++this._index * 2 >= this._array_h.length()) {\n\t                    this._array_h.slice(this._index);\n\t                    this._index = 0;\n\t                }\n\t            }\n\t            return ret;\n\t        },\n\n\t        /**\n\t         * 返回队列中头部(即最新添加的)的动态对象\n\t         *\n\t         * @return {Object} [description]\n\t         */\n\t        head: function () {\n\t            var ret = null, len = this._array_h.length();\n\t            if (len) {\n\t                ret = this._array_h.at(len - 1);\n\t            }\n\t            return ret;\n\t        },\n\n\t        /**\n\t         * 返回队列中尾部(即最早添加的)的动态对象\n\t         *\n\t         * @return {Object} [description]\n\t         */\n\t        tail: function () {\n\t            var ret = null, len = this._array_h.length();\n\t            if (len) {\n\t                ret = this._array_h.at(this._index);\n\t            }\n\t            return ret;\n\t        },\n\n\t        /**\n\t         * 返回数据队列长度\n\t         *\n\t         * @return {Number} [description]\n\t         */\n\t        length: function () {\n\t            return this._array_h.length() - this._index;\n\t        },\n\n\t        /**\n\t         * 队列是否为空\n\t         *\n\t         * @return {Boolean} [description]\n\t         */\n\t        empty: function () {\n\t            return (this._array_h.length() === 0);\n\t        },\n\n\t        clear: function () {\n\t            this._array_h.clear();\n\t        }\n\t    };\n\t    exports.Queue = Queue;\n\t}());\n\n\n/***/ }\n/******/ ])\n});\n;"]}